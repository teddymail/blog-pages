{"title":"Centos7上搭建统一认证服务","date":"2018-10-24T14:45:04.000Z","source":"_posts/2018-10-24.Centos7上搭建统一认证服务.md","raw":"---\ntitle: Centos7上搭建统一认证服务\ndate: 2018-10-24 22:45:04\ntags: [OpenLdap,Centos]\n---\n\n>一个企业经常会碰上部署多台机器的问题，但是账号管理就成了问题，怎么在N台机器上统一部署账号管理，完成账号统一认证和管理是让我们后续非常方便的地方。\n\n\n```shell\n//安装三大应用，服务端，客户端，导出导入工具\nyum install -y openldap-servers openldap-clients migrationtools\n\n//配置文件\ncp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG\nchown ldap. /var/lib/ldap/DB_CONFIG\n\n//启动服务\nsystemctl start slapd\nsystemctl enable slapd\n\n//生成root密码\n╭─root@ykdev ~\n╰─# slappasswd\nNew password:\nRe-enter new password:\n{SSHA}/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l\n\n//修改rootdn密码\ncat chrootpw.ldif\ndn: olcDatabase={0}config,cn=config\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l\n\nldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif\n\n\n\n//导出基础的Schema，这些 Schema 文件位于 /etc/openldap/schema/ 目录中，定义了我们以后创建的条目可以使用哪些属性\n[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif \nSASL/EXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nadding new entry \"cn=cosine,cn=schema,cn=config\"\n\n[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif \nSASL/EXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nadding new entry \"cn=nis,cn=schema,cn=config\"\n\n[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif \nSASL/EXTERNAL authentication started\nSASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\nSASL SSF: 0\nadding new entry \"cn=inetorgperson,cn=schema,cn=config\"\n\n//配置 LDAP 的顶级域\n[root@proxy ldap]# cat chdomain.ldif\ndn: olcDatabase={1}monitor,cn=config\nchangetype: modify\nreplace: olcAccess\nolcAccess: {0}to * by dn.base=\"gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth\"\n  read by dn.base=\"cn=Manager,dc=my-domain,dc=com\" read by * none\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcSuffix\nolcSuffix: dc=my-domain,dc=com\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn=Manager,dc=my-domain,dc=com\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcRootPW\nolcRootPW: {SSHA}/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nadd: olcAccess\nolcAccess: {0}to attrs=userPassword,shadowLastChange by\n  dn=\"cn=Manager,dc=my-domain,dc=com\" write by anonymous auth by self write by * none\nolcAccess: {1}to dn.base=\"\" by * read\nolcAccess: {2}to * by dn=\"cn=Manager,dc=my-domain,dc=com\" write by * read\n\n[root@localhost ~]# ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif \n\n//导入基础组信息什么的\n[root@proxy ldap]# cat base.ldif\ndn: dc=my-domain,dc=com\ndc: my-domain\nobjectClass: top\nobjectClass: domain\n\ndn: ou=People,dc=my-domain,dc=com\nou: People\nobjectClass: top\nobjectClass: organizationalUnit\n\ndn: ou=Group,dc=my-domain,dc=com\nou: Group\nobjectClass: top\nobjectClass: organizationalUnit\n\nldapadd -x -D \"cn=Manager,dc=my-domain,dc=com\" -W -f base.ldif\n\n//导入用户信息\n//修改域名基础信息\nvi /usr/share/migrationtools/migrate_common.ph\n$DEFAULT_BASE = \"dc=my-domain,dc=com\";\n[root@proxy ldap]# /usr/share/migrationtools/migrate_passwd.pl /etc/passwd passwd.ldif\n[root@proxy ldap]# /usr/share/migrationtools/migrate_group.pl /etc/group group.ldif\n[root@proxy ldap]# ldapadd -x -D cn=Manager,dc=my-domain,dc=com -W -f passwd.ldif\n[root@proxy ldap]# ldapadd -x -D cn=Manager,dc=my-domain,dc=com -W -f group.ldif\n\n//查看所有记录\n[root@proxy ldap]# ldapsearch -x -b \"dc=my-domain,dc=com\" -H ldap://192.168.1.1\n```\n\n至此全部搭建完毕\n","slug":"2018-10-24-Centos7上搭建统一认证服务","published":true,"updated":"2024-09-02T09:06:11.430Z","_id":"cm0p50fv30028oxsnf6jtdb37","comments":true,"layout":"post","photos":[],"html":"<blockquote>\n<p>一个企业经常会碰上部署多台机器的问题，但是账号管理就成了问题，怎么在N台机器上统一部署账号管理，完成账号统一认证和管理是让我们后续非常方便的地方。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//安装三大应用，服务端，客户端，导出导入工具</span><br><span class=\"line\">yum install -y openldap-servers openldap-clients migrationtools</span><br><span class=\"line\"></span><br><span class=\"line\">//配置文件</span><br><span class=\"line\">cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span><br><span class=\"line\">chown ldap. /var/lib/ldap/DB_CONFIG</span><br><span class=\"line\"></span><br><span class=\"line\">//启动服务</span><br><span class=\"line\">systemctl start slapd</span><br><span class=\"line\">systemctl enable slapd</span><br><span class=\"line\"></span><br><span class=\"line\">//生成root密码</span><br><span class=\"line\">╭─root@ykdev ~</span><br><span class=\"line\">╰─# slappasswd</span><br><span class=\"line\">New password:</span><br><span class=\"line\">Re-enter new password:</span><br><span class=\"line\">&#123;SSHA&#125;/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l</span><br><span class=\"line\"></span><br><span class=\"line\">//修改rootdn密码</span><br><span class=\"line\">cat chrootpw.ldif</span><br><span class=\"line\">dn: olcDatabase=&#123;0&#125;config,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">add: olcRootPW</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l</span><br><span class=\"line\"></span><br><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//导出基础的Schema，这些 Schema 文件位于 /etc/openldap/schema/ 目录中，定义了我们以后创建的条目可以使用哪些属性</span><br><span class=\"line\">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif </span><br><span class=\"line\">SASL/EXTERNAL authentication started</span><br><span class=\"line\">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class=\"line\">SASL SSF: 0</span><br><span class=\"line\">adding new entry &quot;cn=cosine,cn=schema,cn=config&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif </span><br><span class=\"line\">SASL/EXTERNAL authentication started</span><br><span class=\"line\">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class=\"line\">SASL SSF: 0</span><br><span class=\"line\">adding new entry &quot;cn=nis,cn=schema,cn=config&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif </span><br><span class=\"line\">SASL/EXTERNAL authentication started</span><br><span class=\"line\">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class=\"line\">SASL SSF: 0</span><br><span class=\"line\">adding new entry &quot;cn=inetorgperson,cn=schema,cn=config&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">//配置 LDAP 的顶级域</span><br><span class=\"line\">[root@proxy ldap]# cat chdomain.ldif</span><br><span class=\"line\">dn: olcDatabase=&#123;1&#125;monitor,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcAccess</span><br><span class=\"line\">olcAccess: &#123;0&#125;to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;</span><br><span class=\"line\">  read by dn.base=&quot;cn=Manager,dc=my-domain,dc=com&quot; read by * none</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcSuffix</span><br><span class=\"line\">olcSuffix: dc=my-domain,dc=com</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcRootDN</span><br><span class=\"line\">olcRootDN: cn=Manager,dc=my-domain,dc=com</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcRootPW</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">add: olcAccess</span><br><span class=\"line\">olcAccess: &#123;0&#125;to attrs=userPassword,shadowLastChange by</span><br><span class=\"line\">  dn=&quot;cn=Manager,dc=my-domain,dc=com&quot; write by anonymous auth by self write by * none</span><br><span class=\"line\">olcAccess: &#123;1&#125;to dn.base=&quot;&quot; by * read</span><br><span class=\"line\">olcAccess: &#123;2&#125;to * by dn=&quot;cn=Manager,dc=my-domain,dc=com&quot; write by * read</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif </span><br><span class=\"line\"></span><br><span class=\"line\">//导入基础组信息什么的</span><br><span class=\"line\">[root@proxy ldap]# cat base.ldif</span><br><span class=\"line\">dn: dc=my-domain,dc=com</span><br><span class=\"line\">dc: my-domain</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: domain</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou=People,dc=my-domain,dc=com</span><br><span class=\"line\">ou: People</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou=Group,dc=my-domain,dc=com</span><br><span class=\"line\">ou: Group</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\"></span><br><span class=\"line\">ldapadd -x -D &quot;cn=Manager,dc=my-domain,dc=com&quot; -W -f base.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">//导入用户信息</span><br><span class=\"line\">//修改域名基础信息</span><br><span class=\"line\">vi /usr/share/migrationtools/migrate_common.ph</span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">DEFAULT_BASE = <span class=\"string\">&quot;dc=my-domain,dc=com&quot;</span>;</span></span><br><span class=\"line\">[root@proxy ldap]# /usr/share/migrationtools/migrate_passwd.pl /etc/passwd passwd.ldif</span><br><span class=\"line\">[root@proxy ldap]# /usr/share/migrationtools/migrate_group.pl /etc/group group.ldif</span><br><span class=\"line\">[root@proxy ldap]# ldapadd -x -D cn=Manager,dc=my-domain,dc=com -W -f passwd.ldif</span><br><span class=\"line\">[root@proxy ldap]# ldapadd -x -D cn=Manager,dc=my-domain,dc=com -W -f group.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">//查看所有记录</span><br><span class=\"line\">[root@proxy ldap]# ldapsearch -x -b &quot;dc=my-domain,dc=com&quot; -H ldap://192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<p>至此全部搭建完毕</p>\n","excerpt":"","more":"<blockquote>\n<p>一个企业经常会碰上部署多台机器的问题，但是账号管理就成了问题，怎么在N台机器上统一部署账号管理，完成账号统一认证和管理是让我们后续非常方便的地方。</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//安装三大应用，服务端，客户端，导出导入工具</span><br><span class=\"line\">yum install -y openldap-servers openldap-clients migrationtools</span><br><span class=\"line\"></span><br><span class=\"line\">//配置文件</span><br><span class=\"line\">cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span><br><span class=\"line\">chown ldap. /var/lib/ldap/DB_CONFIG</span><br><span class=\"line\"></span><br><span class=\"line\">//启动服务</span><br><span class=\"line\">systemctl start slapd</span><br><span class=\"line\">systemctl enable slapd</span><br><span class=\"line\"></span><br><span class=\"line\">//生成root密码</span><br><span class=\"line\">╭─root@ykdev ~</span><br><span class=\"line\">╰─# slappasswd</span><br><span class=\"line\">New password:</span><br><span class=\"line\">Re-enter new password:</span><br><span class=\"line\">&#123;SSHA&#125;/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l</span><br><span class=\"line\"></span><br><span class=\"line\">//修改rootdn密码</span><br><span class=\"line\">cat chrootpw.ldif</span><br><span class=\"line\">dn: olcDatabase=&#123;0&#125;config,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">add: olcRootPW</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l</span><br><span class=\"line\"></span><br><span class=\"line\">ldapadd -Y EXTERNAL -H ldapi:/// -f chrootpw.ldif</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//导出基础的Schema，这些 Schema 文件位于 /etc/openldap/schema/ 目录中，定义了我们以后创建的条目可以使用哪些属性</span><br><span class=\"line\">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif </span><br><span class=\"line\">SASL/EXTERNAL authentication started</span><br><span class=\"line\">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class=\"line\">SASL SSF: 0</span><br><span class=\"line\">adding new entry &quot;cn=cosine,cn=schema,cn=config&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif </span><br><span class=\"line\">SASL/EXTERNAL authentication started</span><br><span class=\"line\">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class=\"line\">SASL SSF: 0</span><br><span class=\"line\">adding new entry &quot;cn=nis,cn=schema,cn=config&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif </span><br><span class=\"line\">SASL/EXTERNAL authentication started</span><br><span class=\"line\">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class=\"line\">SASL SSF: 0</span><br><span class=\"line\">adding new entry &quot;cn=inetorgperson,cn=schema,cn=config&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">//配置 LDAP 的顶级域</span><br><span class=\"line\">[root@proxy ldap]# cat chdomain.ldif</span><br><span class=\"line\">dn: olcDatabase=&#123;1&#125;monitor,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcAccess</span><br><span class=\"line\">olcAccess: &#123;0&#125;to * by dn.base=&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;</span><br><span class=\"line\">  read by dn.base=&quot;cn=Manager,dc=my-domain,dc=com&quot; read by * none</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcSuffix</span><br><span class=\"line\">olcSuffix: dc=my-domain,dc=com</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcRootDN</span><br><span class=\"line\">olcRootDN: cn=Manager,dc=my-domain,dc=com</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">replace: olcRootPW</span><br><span class=\"line\">olcRootPW: &#123;SSHA&#125;/UFZ8EehpMMtKiiAy+vxdxH6fObhaF3l</span><br><span class=\"line\"></span><br><span class=\"line\">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class=\"line\">changetype: modify</span><br><span class=\"line\">add: olcAccess</span><br><span class=\"line\">olcAccess: &#123;0&#125;to attrs=userPassword,shadowLastChange by</span><br><span class=\"line\">  dn=&quot;cn=Manager,dc=my-domain,dc=com&quot; write by anonymous auth by self write by * none</span><br><span class=\"line\">olcAccess: &#123;1&#125;to dn.base=&quot;&quot; by * read</span><br><span class=\"line\">olcAccess: &#123;2&#125;to * by dn=&quot;cn=Manager,dc=my-domain,dc=com&quot; write by * read</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]# ldapmodify -Y EXTERNAL -H ldapi:/// -f chdomain.ldif </span><br><span class=\"line\"></span><br><span class=\"line\">//导入基础组信息什么的</span><br><span class=\"line\">[root@proxy ldap]# cat base.ldif</span><br><span class=\"line\">dn: dc=my-domain,dc=com</span><br><span class=\"line\">dc: my-domain</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: domain</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou=People,dc=my-domain,dc=com</span><br><span class=\"line\">ou: People</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\"></span><br><span class=\"line\">dn: ou=Group,dc=my-domain,dc=com</span><br><span class=\"line\">ou: Group</span><br><span class=\"line\">objectClass: top</span><br><span class=\"line\">objectClass: organizationalUnit</span><br><span class=\"line\"></span><br><span class=\"line\">ldapadd -x -D &quot;cn=Manager,dc=my-domain,dc=com&quot; -W -f base.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">//导入用户信息</span><br><span class=\"line\">//修改域名基础信息</span><br><span class=\"line\">vi /usr/share/migrationtools/migrate_common.ph</span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">DEFAULT_BASE = <span class=\"string\">&quot;dc=my-domain,dc=com&quot;</span>;</span></span><br><span class=\"line\">[root@proxy ldap]# /usr/share/migrationtools/migrate_passwd.pl /etc/passwd passwd.ldif</span><br><span class=\"line\">[root@proxy ldap]# /usr/share/migrationtools/migrate_group.pl /etc/group group.ldif</span><br><span class=\"line\">[root@proxy ldap]# ldapadd -x -D cn=Manager,dc=my-domain,dc=com -W -f passwd.ldif</span><br><span class=\"line\">[root@proxy ldap]# ldapadd -x -D cn=Manager,dc=my-domain,dc=com -W -f group.ldif</span><br><span class=\"line\"></span><br><span class=\"line\">//查看所有记录</span><br><span class=\"line\">[root@proxy ldap]# ldapsearch -x -b &quot;dc=my-domain,dc=com&quot; -H ldap://192.168.1.1</span><br></pre></td></tr></table></figure>\n\n<p>至此全部搭建完毕</p>\n","path":"2018/10/24/2018-10-24-Centos7上搭建统一认证服务/","permalink":"https://yuekang.org.cn/2018/10/24/2018-10-24-Centos7%E4%B8%8A%E6%90%AD%E5%BB%BA%E7%BB%9F%E4%B8%80%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1/","tags":[{"name":"OpenLdap","_id":"cm0p50fvq0064oxsnhhr2157u","slug":"OpenLdap","path":"tags/OpenLdap/","permalink":"https://yuekang.org.cn/tags/OpenLdap/","length":2},{"name":"Centos","_id":"cm0p50fvq0067oxsn3wo3b8g8","slug":"Centos","path":"tags/Centos/","permalink":"https://yuekang.org.cn/tags/Centos/","length":1}],"categories":[],"prev":{"title":"ZooKeeper集群化安装","date":"2018-11-05T07:51:13.000Z","slug":"2018-11-05-ZooKeeper集群化安装","published":true,"updated":"2024-09-02T09:06:11.430Z","_id":"cm0p50fva002doxsnfp0ihwi2","layout":"post","photos":[],"excerpt":"","path":"2018/11/05/2018-11-05-ZooKeeper集群化安装/","permalink":"https://yuekang.org.cn/2018/11/05/2018-11-05-ZooKeeper%E9%9B%86%E7%BE%A4%E5%8C%96%E5%AE%89%E8%A3%85/","__post":true},"next":{"title":"KeepAlived搭建","date":"2018-09-29T10:03:13.000Z","slug":"2018-09-29-KeepAlived搭建","published":true,"updated":"2024-09-02T09:06:11.429Z","_id":"cm0p50fv20025oxsndzof7ojx","layout":"post","photos":[],"excerpt":"","path":"2018/09/29/2018-09-29-KeepAlived搭建/","permalink":"https://yuekang.org.cn/2018/09/29/2018-09-29-KeepAlived%E6%90%AD%E5%BB%BA/","__post":true},"__post":true}