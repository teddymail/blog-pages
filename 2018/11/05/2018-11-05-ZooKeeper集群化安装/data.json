{"title":"ZooKeeper集群化安装","date":"2018-11-05T07:51:13.000Z","source":"_posts/2018-11-05.ZooKeeper集群化安装.md","raw":"---\ntitle: ZooKeeper集群化安装\ndate: 2018-11-05 15:51:13\ntags: [ZooKeeper]\n---\n\n>zookeeper是一个强一致【不严格】的分布式数据库，由多个节点共同组成一个分布式集群，挂掉任意一个节点，数据库仍然可以正常工作，客户端无感知故障切换。客户端向任意一个节点写入数据，其它节点可以立即看到最新的数据。\n\n## 布局规划图\n\n![架构图](http://img.yuekang.org.cn/2018110565853.png)\n\n\n## 环境准备\n\n1. JRE (依赖的环境)【 [点击进入](https://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html) 】\n\n安装JRE\n```\ntar zxvf jre-8u191-linux-x64.tar.gz\nmv jre1.8.0_191/ /opt/\n//添加环境变量\nvi /etc/profile\n//末尾加入\nJAVA_HOME=/opt/jre1.8.0_191\nPATH=$JAVA_HOME/bin:$PATH\nCLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar\nexport JAVA_HOME\nexport PATH\nexport CLASSPATH\n//生效配置\nsource /etc/profile \n```\n\n\b开启端口\n>默认是2181 我自己设定为2999，2888和3888是机器之间同步端口\n\n```\nfirewall-cmd --zone=public --add-port=2999/tcp --permanent\nfirewall-cmd --zone=public --add-port=2888/tcp --permanent\nfirewall-cmd --zone=public --add-port=3888/tcp --permanent\nfirewall-cmd --reload\n```\n\n2. ZooKeeper安装包 \n\n```\nwget http://mirror.cogentco.com/pub/apache/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz\n\ntar zxvf zookeeper-3.4.13.tar.gz\n\nmv zookeeper-3.4.13 /opt/\n```\n## 安装配置ZooKeeper\n\n>基础环境安装完成后，需要配置\bZooKeeper\n\n```\n//配置\ncp /opt/zookeeper-3.4.13/conf/zoo_sample.cfg /opt/zookeeper-3.4.13/conf/zoo.cfg\n\nvi /opt/zookeeper-3.4.13/conf/zoo.cfg\n```\n\n有以下配置选项\n\n1. tickTime=2000\n\n最小时间单元长度，默认3000，例如回话的最小超时时间默认2*tickTIme\n\n2. initLimit=5\n\n默认：10，定义leader服务在启动过程中等待follower完成数据同步的时间，后续服务器增多需要增大这个值，以保证数据同步顺利完成。\n\n3. dataDir=/var/lib/zookeeper/\n\n无默认，必须配置，用于配置ZooKeeper存放快照文件的目录，如果不配置dataLogDir则也存放在这里面。\n\n4. clientPort=2999\n\n当前服务对外的端口，集群内服务器都可以配置任意可用端口，\b不需要保持端口一致！一般是2181， 无默认，必须配置！\n\n5. server.1 = server1:2888:3888\n\n用于定义整个集群是由那几台机器构成的，每一行代表一个机器配置格式如下：\n\nserver.id = host:localPort:targetPort\n\n创建myid文件标识当前主机的序号，在dataDir中新建\n\n```\nvi /var/lib/zookeeper/myid\n写上当前主机的序号即可，一定要是整数！\n```\n\n\n启动ZooKeeper\n\n```\n/opt/zookeeper-3.4.13/bin/zkServer.sh start\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.13/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n```\n\n看到上方标识意味启动成功\n\n\n## 验证\u001dZooKeeper服务\n\n```\n[root@zookeepermaster bin]# telnet localhost 2999\nTrying ::1...\nConnected to localhost.\nEscape character is '^]'.\nstat\nZookeeper version: 3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03, built on 06/29/2018 04:05 GMT\nClients:\n /0:0:0:0:0:0:0:1:56564[0](queued=0,recved=1,sent=0)\n\nLatency min/avg/max: 0/0/0\nReceived: 1\nSent: 0\nConnections: 1\nOutstanding: 0\nZxid: 0x200000000\nMode: follower\nNode count: 4\nConnection closed by foreign host.\n```\n\n像上方这样的返回意味着已经成功运行ZooKeeper了，其中Mode: follower是当前的身份\n\n1. Mode: leader\n\nleader 是节点中选举的主节点整个服务器中就1个\n\n2. Mode: follower\n\nfollower 是从节点，负责服务客户端\n\n3. Mode: standalone\n\nstandalone 是单机模式下才会有的\n\n## 采坑集结\n\n如果telnet验证时返回下面这样的情况\n\n```\n[root@zookeepermaster bin]# telnet 127.0.0.1 2999\nTrying 127.0.0.1...\nConnected to 127.0.0.1.\nEscape character is '^]'.\nstat\nThis ZooKeeper instance is not currently serving requests\nConnection closed by foreign host.\n```\n碰到上面的情况首先应该检查各个服务节点的机器是否端口已经全部打开？,主要原因就是这个节点无法连接其他服务器造成服务无法选举造成了服务出错\n\n","slug":"2018-11-05-ZooKeeper集群化安装","published":true,"updated":"2024-09-02T09:06:11.430Z","_id":"cm0oyp55q002aeesn9selgxmr","comments":true,"layout":"post","photos":[],"html":"<blockquote>\n<p>zookeeper是一个强一致【不严格】的分布式数据库，由多个节点共同组成一个分布式集群，挂掉任意一个节点，数据库仍然可以正常工作，客户端无感知故障切换。客户端向任意一个节点写入数据，其它节点可以立即看到最新的数据。</p>\n</blockquote>\n<h2 id=\"布局规划图\"><a href=\"#布局规划图\" class=\"headerlink\" title=\"布局规划图\"></a>布局规划图</h2><p><img src=\"http://img.yuekang.org.cn/2018110565853.png\" alt=\"架构图\"></p>\n<h2 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h2><ol>\n<li>JRE (依赖的环境)【 <a href=\"https://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html\">点击进入</a> 】</li>\n</ol>\n<p>安装JRE</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf jre-8u191-linux-x64.tar.gz</span><br><span class=\"line\">mv jre1.8.0_191/ /opt/</span><br><span class=\"line\">//添加环境变量</span><br><span class=\"line\">vi /etc/profile</span><br><span class=\"line\">//末尾加入</span><br><span class=\"line\">JAVA_HOME=/opt/jre1.8.0_191</span><br><span class=\"line\">PATH=$JAVA_HOME/bin:$PATH</span><br><span class=\"line\">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class=\"line\">export JAVA_HOME</span><br><span class=\"line\">export PATH</span><br><span class=\"line\">export CLASSPATH</span><br><span class=\"line\">//生效配置</span><br><span class=\"line\">source /etc/profile </span><br></pre></td></tr></table></figure>\n\n<p>\b开启端口</p>\n<blockquote>\n<p>默认是2181 我自己设定为2999，2888和3888是机器之间同步端口</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=2999/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=2888/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=3888/tcp --permanent</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>ZooKeeper安装包</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://mirror.cogentco.com/pub/apache/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar zxvf zookeeper-3.4.13.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">mv zookeeper-3.4.13 /opt/</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装配置ZooKeeper\"><a href=\"#安装配置ZooKeeper\" class=\"headerlink\" title=\"安装配置ZooKeeper\"></a>安装配置ZooKeeper</h2><blockquote>\n<p>基础环境安装完成后，需要配置\bZooKeeper</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//配置</span><br><span class=\"line\">cp /opt/zookeeper-3.4.13/conf/zoo_sample.cfg /opt/zookeeper-3.4.13/conf/zoo.cfg</span><br><span class=\"line\"></span><br><span class=\"line\">vi /opt/zookeeper-3.4.13/conf/zoo.cfg</span><br></pre></td></tr></table></figure>\n\n<p>有以下配置选项</p>\n<ol>\n<li>tickTime&#x3D;2000</li>\n</ol>\n<p>最小时间单元长度，默认3000，例如回话的最小超时时间默认2*tickTIme</p>\n<ol start=\"2\">\n<li>initLimit&#x3D;5</li>\n</ol>\n<p>默认：10，定义leader服务在启动过程中等待follower完成数据同步的时间，后续服务器增多需要增大这个值，以保证数据同步顺利完成。</p>\n<ol start=\"3\">\n<li>dataDir&#x3D;&#x2F;var&#x2F;lib&#x2F;zookeeper&#x2F;</li>\n</ol>\n<p>无默认，必须配置，用于配置ZooKeeper存放快照文件的目录，如果不配置dataLogDir则也存放在这里面。</p>\n<ol start=\"4\">\n<li>clientPort&#x3D;2999</li>\n</ol>\n<p>当前服务对外的端口，集群内服务器都可以配置任意可用端口，\b不需要保持端口一致！一般是2181， 无默认，必须配置！</p>\n<ol start=\"5\">\n<li>server.1 &#x3D; server1:2888:3888</li>\n</ol>\n<p>用于定义整个集群是由那几台机器构成的，每一行代表一个机器配置格式如下：</p>\n<p>server.id &#x3D; host:localPort:targetPort</p>\n<p>创建myid文件标识当前主机的序号，在dataDir中新建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /var/lib/zookeeper/myid</span><br><span class=\"line\">写上当前主机的序号即可，一定要是整数！</span><br></pre></td></tr></table></figure>\n\n\n<p>启动ZooKeeper</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/opt/zookeeper-3.4.13/bin/zkServer.sh start</span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /opt/zookeeper-3.4.13/bin/../conf/zoo.cfg</span><br><span class=\"line\">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>\n\n<p>看到上方标识意味启动成功</p>\n<h2 id=\"验证ZooKeeper服务\"><a href=\"#验证ZooKeeper服务\" class=\"headerlink\" title=\"验证\u001dZooKeeper服务\"></a>验证\u001dZooKeeper服务</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@zookeepermaster bin]# telnet localhost 2999</span><br><span class=\"line\">Trying ::1...</span><br><span class=\"line\">Connected to localhost.</span><br><span class=\"line\">Escape character is &#x27;^]&#x27;.</span><br><span class=\"line\">stat</span><br><span class=\"line\">Zookeeper version: 3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03, built on 06/29/2018 04:05 GMT</span><br><span class=\"line\">Clients:</span><br><span class=\"line\"> /0:0:0:0:0:0:0:1:56564[0](queued=0,recved=1,sent=0)</span><br><span class=\"line\"></span><br><span class=\"line\">Latency min/avg/max: 0/0/0</span><br><span class=\"line\">Received: 1</span><br><span class=\"line\">Sent: 0</span><br><span class=\"line\">Connections: 1</span><br><span class=\"line\">Outstanding: 0</span><br><span class=\"line\">Zxid: 0x200000000</span><br><span class=\"line\">Mode: follower</span><br><span class=\"line\">Node count: 4</span><br><span class=\"line\">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>\n\n<p>像上方这样的返回意味着已经成功运行ZooKeeper了，其中Mode: follower是当前的身份</p>\n<ol>\n<li>Mode: leader</li>\n</ol>\n<p>leader 是节点中选举的主节点整个服务器中就1个</p>\n<ol start=\"2\">\n<li>Mode: follower</li>\n</ol>\n<p>follower 是从节点，负责服务客户端</p>\n<ol start=\"3\">\n<li>Mode: standalone</li>\n</ol>\n<p>standalone 是单机模式下才会有的</p>\n<h2 id=\"采坑集结\"><a href=\"#采坑集结\" class=\"headerlink\" title=\"采坑集结\"></a>采坑集结</h2><p>如果telnet验证时返回下面这样的情况</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@zookeepermaster bin]# telnet 127.0.0.1 2999</span><br><span class=\"line\">Trying 127.0.0.1...</span><br><span class=\"line\">Connected to 127.0.0.1.</span><br><span class=\"line\">Escape character is &#x27;^]&#x27;.</span><br><span class=\"line\">stat</span><br><span class=\"line\">This ZooKeeper instance is not currently serving requests</span><br><span class=\"line\">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>\n<p>碰到上面的情况首先应该检查各个服务节点的机器是否端口已经全部打开？,主要原因就是这个节点无法连接其他服务器造成服务无法选举造成了服务出错</p>\n","excerpt":"","more":"<blockquote>\n<p>zookeeper是一个强一致【不严格】的分布式数据库，由多个节点共同组成一个分布式集群，挂掉任意一个节点，数据库仍然可以正常工作，客户端无感知故障切换。客户端向任意一个节点写入数据，其它节点可以立即看到最新的数据。</p>\n</blockquote>\n<h2 id=\"布局规划图\"><a href=\"#布局规划图\" class=\"headerlink\" title=\"布局规划图\"></a>布局规划图</h2><p><img src=\"http://img.yuekang.org.cn/2018110565853.png\" alt=\"架构图\"></p>\n<h2 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h2><ol>\n<li>JRE (依赖的环境)【 <a href=\"https://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html\">点击进入</a> 】</li>\n</ol>\n<p>安装JRE</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf jre-8u191-linux-x64.tar.gz</span><br><span class=\"line\">mv jre1.8.0_191/ /opt/</span><br><span class=\"line\">//添加环境变量</span><br><span class=\"line\">vi /etc/profile</span><br><span class=\"line\">//末尾加入</span><br><span class=\"line\">JAVA_HOME=/opt/jre1.8.0_191</span><br><span class=\"line\">PATH=$JAVA_HOME/bin:$PATH</span><br><span class=\"line\">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class=\"line\">export JAVA_HOME</span><br><span class=\"line\">export PATH</span><br><span class=\"line\">export CLASSPATH</span><br><span class=\"line\">//生效配置</span><br><span class=\"line\">source /etc/profile </span><br></pre></td></tr></table></figure>\n\n<p>\b开启端口</p>\n<blockquote>\n<p>默认是2181 我自己设定为2999，2888和3888是机器之间同步端口</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=2999/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=2888/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=3888/tcp --permanent</span><br><span class=\"line\">firewall-cmd --reload</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>ZooKeeper安装包</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://mirror.cogentco.com/pub/apache/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar zxvf zookeeper-3.4.13.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">mv zookeeper-3.4.13 /opt/</span><br></pre></td></tr></table></figure>\n<h2 id=\"安装配置ZooKeeper\"><a href=\"#安装配置ZooKeeper\" class=\"headerlink\" title=\"安装配置ZooKeeper\"></a>安装配置ZooKeeper</h2><blockquote>\n<p>基础环境安装完成后，需要配置\bZooKeeper</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//配置</span><br><span class=\"line\">cp /opt/zookeeper-3.4.13/conf/zoo_sample.cfg /opt/zookeeper-3.4.13/conf/zoo.cfg</span><br><span class=\"line\"></span><br><span class=\"line\">vi /opt/zookeeper-3.4.13/conf/zoo.cfg</span><br></pre></td></tr></table></figure>\n\n<p>有以下配置选项</p>\n<ol>\n<li>tickTime&#x3D;2000</li>\n</ol>\n<p>最小时间单元长度，默认3000，例如回话的最小超时时间默认2*tickTIme</p>\n<ol start=\"2\">\n<li>initLimit&#x3D;5</li>\n</ol>\n<p>默认：10，定义leader服务在启动过程中等待follower完成数据同步的时间，后续服务器增多需要增大这个值，以保证数据同步顺利完成。</p>\n<ol start=\"3\">\n<li>dataDir&#x3D;&#x2F;var&#x2F;lib&#x2F;zookeeper&#x2F;</li>\n</ol>\n<p>无默认，必须配置，用于配置ZooKeeper存放快照文件的目录，如果不配置dataLogDir则也存放在这里面。</p>\n<ol start=\"4\">\n<li>clientPort&#x3D;2999</li>\n</ol>\n<p>当前服务对外的端口，集群内服务器都可以配置任意可用端口，\b不需要保持端口一致！一般是2181， 无默认，必须配置！</p>\n<ol start=\"5\">\n<li>server.1 &#x3D; server1:2888:3888</li>\n</ol>\n<p>用于定义整个集群是由那几台机器构成的，每一行代表一个机器配置格式如下：</p>\n<p>server.id &#x3D; host:localPort:targetPort</p>\n<p>创建myid文件标识当前主机的序号，在dataDir中新建</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /var/lib/zookeeper/myid</span><br><span class=\"line\">写上当前主机的序号即可，一定要是整数！</span><br></pre></td></tr></table></figure>\n\n\n<p>启动ZooKeeper</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/opt/zookeeper-3.4.13/bin/zkServer.sh start</span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /opt/zookeeper-3.4.13/bin/../conf/zoo.cfg</span><br><span class=\"line\">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>\n\n<p>看到上方标识意味启动成功</p>\n<h2 id=\"验证ZooKeeper服务\"><a href=\"#验证ZooKeeper服务\" class=\"headerlink\" title=\"验证\u001dZooKeeper服务\"></a>验证\u001dZooKeeper服务</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@zookeepermaster bin]# telnet localhost 2999</span><br><span class=\"line\">Trying ::1...</span><br><span class=\"line\">Connected to localhost.</span><br><span class=\"line\">Escape character is &#x27;^]&#x27;.</span><br><span class=\"line\">stat</span><br><span class=\"line\">Zookeeper version: 3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03, built on 06/29/2018 04:05 GMT</span><br><span class=\"line\">Clients:</span><br><span class=\"line\"> /0:0:0:0:0:0:0:1:56564[0](queued=0,recved=1,sent=0)</span><br><span class=\"line\"></span><br><span class=\"line\">Latency min/avg/max: 0/0/0</span><br><span class=\"line\">Received: 1</span><br><span class=\"line\">Sent: 0</span><br><span class=\"line\">Connections: 1</span><br><span class=\"line\">Outstanding: 0</span><br><span class=\"line\">Zxid: 0x200000000</span><br><span class=\"line\">Mode: follower</span><br><span class=\"line\">Node count: 4</span><br><span class=\"line\">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>\n\n<p>像上方这样的返回意味着已经成功运行ZooKeeper了，其中Mode: follower是当前的身份</p>\n<ol>\n<li>Mode: leader</li>\n</ol>\n<p>leader 是节点中选举的主节点整个服务器中就1个</p>\n<ol start=\"2\">\n<li>Mode: follower</li>\n</ol>\n<p>follower 是从节点，负责服务客户端</p>\n<ol start=\"3\">\n<li>Mode: standalone</li>\n</ol>\n<p>standalone 是单机模式下才会有的</p>\n<h2 id=\"采坑集结\"><a href=\"#采坑集结\" class=\"headerlink\" title=\"采坑集结\"></a>采坑集结</h2><p>如果telnet验证时返回下面这样的情况</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@zookeepermaster bin]# telnet 127.0.0.1 2999</span><br><span class=\"line\">Trying 127.0.0.1...</span><br><span class=\"line\">Connected to 127.0.0.1.</span><br><span class=\"line\">Escape character is &#x27;^]&#x27;.</span><br><span class=\"line\">stat</span><br><span class=\"line\">This ZooKeeper instance is not currently serving requests</span><br><span class=\"line\">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>\n<p>碰到上面的情况首先应该检查各个服务节点的机器是否端口已经全部打开？,主要原因就是这个节点无法连接其他服务器造成服务无法选举造成了服务出错</p>\n","path":"2018/11/05/2018-11-05-ZooKeeper集群化安装/","permalink":"https://yuekang.org.cn/2018/11/05/2018-11-05-ZooKeeper%E9%9B%86%E7%BE%A4%E5%8C%96%E5%AE%89%E8%A3%85/","tags":[{"name":"ZooKeeper","_id":"cm0oyp568006aeesn504j089f","slug":"ZooKeeper","path":"tags/ZooKeeper/","permalink":"https://yuekang.org.cn/tags/ZooKeeper/","length":1}],"categories":[],"prev":{"title":"php安装ZooKeeper","date":"2018-11-06T11:22:30.000Z","slug":"2018-11-06-php安装ZooKeeper","published":true,"updated":"2024-09-02T09:06:11.430Z","_id":"cm0oyp55r002deesn020s32lw","layout":"post","photos":[],"excerpt":"","path":"2018/11/06/2018-11-06-php安装ZooKeeper/","permalink":"https://yuekang.org.cn/2018/11/06/2018-11-06-php%E5%AE%89%E8%A3%85ZooKeeper/","__post":true},"next":{"title":"Centos7上搭建统一认证服务","date":"2018-10-24T14:45:04.000Z","slug":"2018-10-24-Centos7上搭建统一认证服务","published":true,"updated":"2024-09-02T09:06:11.430Z","_id":"cm0oyp55q0028eesn8dvd8xfo","layout":"post","photos":[],"excerpt":"","path":"2018/10/24/2018-10-24-Centos7上搭建统一认证服务/","permalink":"https://yuekang.org.cn/2018/10/24/2018-10-24-Centos7%E4%B8%8A%E6%90%AD%E5%BB%BA%E7%BB%9F%E4%B8%80%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1/","__post":true},"__post":true}