<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Kange"><title>少年当自强</title><meta name="description" content="Write the code. Change the World."><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta id="site_data_static" data-url="/"><meta id="default-theme" data="light"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/theme/light.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&amp;display=swap" rel="stylesheet"><script src="/js_complied/bundle.js"></script><script src="/js/baidu-tongji.js"></script><script>Anatolo.comment.setConfig({"valine":{"enable":true,"appid":"yXrP5LiEu8aLiXNMbcMkjTgk-gzGzoHsz","appkey":"Fb1nRCpsNrMB0U2Fv3jJSCsu","notify":false,"verify":true,"avatar":"","placeholder":"ψ(｀∇´)ψ 快说说你得想法吧！cn.gravatar.com注册专属头像"},"duoshuo":null,"disqus":null,"gentie":null})</script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@latest/dist/Valine.min.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body> <main-outlet><div class="page-top animated"><div class="nav"><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)" style="display: none"> </a></li><li><a class="fa fa-search" onclick="Anatolo.search.openWindow();"></a></li><li><a class="far fa-sun" onclick="Anatolo.darkLightToggle();"></a></li></div><div class="avatar"><img src="http://img.yuekang.org.cn/me.jpg"></div></div></div><div class="sidebar animated"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:220px;" alt="favicon"><h3 title=""><a href="/">少年当自强</a></h3><div class="description"><p>Write the code. Change the World.</p></div></div><ul class="social-links"><li><a href="https://github.com/teddymail"><i class="fab fa-github"></i></a></li><li><a href="mailto:iyuekang@gmail.com"><i class="fa fa-envelope"></i></a></li><li><a href="https://weibo.com/teddymail"><i class="fab fa-weibo"></i></a></li></ul></div></div><div class="footer"><div class="p"><span>Copyright © Teddy All rights reserved. </span><i class="fa fa-star"></i><span>Kange</span></div><div class="by_farbox"><span>Powered by</span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo</a><span>&</span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank">Anatolo</a></div><div class="beian"></div></div></div><div class="main animated fadeInDown"><div class="autopagerize_page_element"><div class="content"><div class="post animated"><div class="post-title"><h3><a href="/2017/09/11/2017-09-11-23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%8B%B1%E6%96%87%E4%B8%AD%E6%96%87%E5%AF%B9%E7%85%A7/">23种设计模式英文中文对照</a></h3></div><div class="post-content"><div class="card"><p><table>
<thead>
<tr>
<th align="center">序号</th>
<th align="left">模式名</th>
<th align="left">英文名</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="left">简单工厂模式</td>
<td align="left">Simple Factory Pattern</td>
</tr>
<tr>
<td align="center">2</td>
<td align="left">工厂方法模式</td>
<td align="left">Factory Method Pattern</td>
</tr>
<tr>
<td align="center">3</td>
<td align="left">抽象工厂模式</td>
<td align="left">Abstract Factory Pattern</td>
</tr>
<tr>
<td align="center">4</td>
<td align="left">建造者模式</td>
<td align="left">Builder Pattern</td>
</tr>
<tr>
<td align="center">5</td>
<td align="left">原型模式</td>
<td align="left">Prototype Pattern</td>
</tr>
<tr>
<td align="center">6</td>
<td align="left">单例模式</td>
<td align="left">Singleton Pattern</td>
</tr>
<tr>
<td align="center">7</td>
<td align="left">适配器模式</td>
<td align="left">Adapter Pattern</td>
</tr>
<tr>
<td align="center">8</td>
<td align="left">桥梁模式(桥接模式)</td>
<td align="left">Bridge Pattern</td>
</tr>
<tr>
<td align="center">9</td>
<td align="left">组合模式</td>
<td align="left">Composite Pattern</td>
</tr>
<tr>
<td align="center">10</td>
<td align="left">装饰模式</td>
<td align="left">Decorator Pattern</td>
</tr>
<tr>
<td align="center">11</td>
<td align="left">门面模式(外观模式)</td>
<td align="left">Facade Pattern</td>
</tr>
<tr>
<td align="center">12</td>
<td align="left">享元模式</td>
<td align="left">Flyweight Pattern</td>
</tr>
<tr>
<td align="center">13</td>
<td align="left">代理模式</td>
<td align="left">Proxy pattern</td>
</tr>
<tr>
<td align="center">14</td>
<td align="left">责任链模式</td>
<td align="left">Chain of Responsibility Pattern</td>
</tr>
<tr>
<td align="center">15</td>
<td align="left">命令模式</td>
<td align="left">Command Pattern</td>
</tr>
<tr>
<td align="center">16</td>
<td align="left">解释器模式</td>
<td align="left">Interpreter Pattern</td>
</tr>
<tr>
<td align="center">17</td>
<td align="left">迭代器模式</td>
<td align="left">Iterator Pattern</td>
</tr>
<tr>
<td align="center">18</td>
<td align="left">中介者模式</td>
<td align="left">Mediator Pattern</td>
</tr>
<tr>
<td align="center">19</td>
<td align="left">备忘录模式</td>
<td align="left">Memento Pattern</td>
</tr>
<tr>
<td align="center">20</td>
<td align="left">观察者模式</td>
<td align="left">Observer Pattern</td>
</tr>
<tr>
<td align="center">21</td>
<td align="left">状态模式</td>
<td align="left">State Pattern</td>
</tr>
<tr>
<td align="center">22</td>
<td align="left">策略模式</td>
<td align="left">Strategy Pattern</td>
</tr>
<tr>
<td align="center">23</td>
<td align="left">模板方法模式</td>
<td align="left">Template Method Pattern</td>
</tr>
<tr>
<td align="center">24</td>
<td align="left">访问者模式</td>
<td align="left">Visitor Pattern</td>
</tr>
</tbody></table>
<hr>
<p>接下来的一段日子里我将陆续更新每个设计模式的做法，多学习设计模式防止被祭天~  哈哈哈</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-09-11</span><i class="fa fa-tag"></i><a class="tag" href="/tags/设计模式/" title="设计模式">设计模式 </a><span>About 223 words, 44 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/07/28/2017-07-28-%E4%BD%BF%E7%94%A8mysql-router%E5%B7%A5%E5%85%B7%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">使用mysql-router工具实现数据库读写分离，数据库负载均衡</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>研究公司oFrame框架发现，我们框架内大量的sql扫表语句严重的影响了数据查询速度和产品使用的各种问题，为此我准备先从第一步入手去增数据的性能，让我们一起学一下吧.</p>
</blockquote>
<h3 id="一、-环境准备"><a href="#一、-环境准备" class="headerlink" title="一、 环境准备"></a>一、 环境准备</h3><ul>
<li>mysql-router 简单的负载均衡组件</li>
<li>mysql5.6        mysql</li>
<li>centos7</li>
<li>Vmware</li>
</ul>
<p>** mysql-router 简介 **</p>
<p>MySQL的路由器是轻量级的中间件，提供您的应用程序和任何后端MySQL服务器之间的透明路由。它可用于各种各样的使用情况，如通过有效的路由数据库流量到合适的后端MySQL服务器提供高可用性和可扩展性。可插拔的体系结构还使开发者来扩展MySQL的路由器自定义的用例。</p>
<ol>
<li>故障转移</li>
</ol>
<p>典型地，高度可用的MySQL设置由一个单一的主站和多个从机，并且它是由应用程序来处理故障切换，在情况下，MySQL主变得不可用。使用MySQL路由器，应用程序连接将被透明基于负载平衡策略路由，不实现自定义应用程序代码。</p>
<ol start="2">
<li>负载均衡</li>
</ol>
<p>MySQL的路由器通过在服务器池分配数据库的连接提供了额外的可扩展性和性能。举例来说，如果你有一个复制的一套MySQL服务器的，MySQL的路由器可以在一个循环的方式分发应用程序连接到他们。</p>
<ol start="3">
<li>可插入式架构</li>
</ol>
<p>MySQL的路由器的可插入式架构使MySQL的开发人员能够轻松地与附加功能延伸产品，以及提供MySQL用户能够创建提供了无限的可能性自己的自定义插件的能力。MySQL的路由器目前包括一些核心插件，其中包括：</p>
<p>连接路由插件，它确实基于连接的路由，这意味着它转发MySQL的数据包发送到后端服务器，而不检查或修改它们，从而提供最大的吞吐量。<br>的元数据高速缓存插件，它提供了透明的客户端负载平衡，路由和故障转移到组复制和InnoDB群集。</p>
<p><img src="http://img.yuekang.org.cn/mysql_router.png" alt="mysql-router结构示意图"></p>
<h3 id="二、环境搭建"><a href="#二、环境搭建" class="headerlink" title="二、环境搭建"></a>二、环境搭建</h3><blockquote>
<p>这里centos搭建和Vmware不再阐述，mysql的安装也不在讲解，重点讲解配置步骤和实现mysql-router功能</p>
</blockquote>
<ol>
<li>安装mysql-router</li>
</ol>
<p>进入官网下载页面：<a href="https://dev.mysql.com/downloads/router/">点我去往下载页面</a></p>
<p><img src="http://img.yuekang.org.cn/MySQL%20%20%20%20Download%20MySQL%20Router.png" alt="mysql-router下载页面"></p>
<p>这里我选择Red Hat Enterprise Linux 7 &#x2F; Oracle Linux 7也就是上图中的第一个rpm包进行下载</p>
<p>为了在虚拟机中能够方便的复制，我这里下载过程中复制下载地址到虚拟机中使用**[ wget ]**命令进行下载</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# wget https://cdn.mysql.com//Downloads/MySQL-Router/mysql-router-2.1.4-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">--2017-07-28 14:57:02--  https://cdn.mysql.com//Downloads/MySQL-Router/mysql-router-2.1.4-1.el7.x86_64</span><br><span class="line">.rpm</span><br><span class="line">Resolving cdn.mysql.com (cdn.mysql.com)... 2.17.63.195</span><br><span class="line">Connecting to cdn.mysql.com (cdn.mysql.com)|2.17.63.195|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 1947576 (1.9M) [application/x-redhat-package-manager]</span><br><span class="line">Saving to: ‘mysql-router-2.1.4-1.el7.x86_64.rpm’</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">100%</span><span class="language-bash">[============================================================&gt;] 1,947,576    773KB/s   <span class="keyword">in</span> 2.5s</span>   </span><br><span class="line"></span><br><span class="line">2017-07-28 14:57:10 (773 KB/s) - ‘mysql-router-2.1.4-1.el7.x86_64.rpm’ saved [1947576/1947576]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# rpm -i mysql-router-2.1.4-1.el7.x86_64.rpm</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>经过上面的步骤mysql-router已经安装完毕，这里mysql安装不在叙述</p>
<h3 id="三、负载均衡架构规划"><a href="#三、负载均衡架构规划" class="headerlink" title="三、负载均衡架构规划"></a>三、负载均衡架构规划</h3><blockquote>
<p>我由于使用的是虚拟机我这里设定以下几个服务器</p>
</blockquote>
<p>1.Mysql Middleware 安装着mysql-router专门用于mysql入口负责机器的主从分配等问题</p>
<p>2.Mysql Master 数据库主库，用于数据的读写</p>
<p>3.Mysql Salve 数据库从库</p>
<p>我对结构做了如下划分和IP分配，详情见图:</p>
<p><img src="http://img.yuekang.org.cn/%E7%BB%93%E6%9E%84%E5%9B%BE%E7%81%B0%E5%BA%95.png" alt="结构规划图"></p>
<h3 id="四、配置服务"><a href="#四、配置服务" class="headerlink" title="四、配置服务"></a>四、配置服务</h3><p>1.Mysql Middleware (router主机)</p>
<blockquote>
<p>默认rpm安装位置在&#x2F;usr&#x2F;bin&#x2F;mysqlrouter 为了个人意愿我把日志logs和配置文件mysqlrouter.ini都存放在&#x2F;usr&#x2F;local&#x2F;mysql-router下</p>
</blockquote>
<p>下面开始新建配置文件，设置port:8000为读写端口 port:8001为只读端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql-router]# mkdir logs</span><br><span class="line">[root@localhost mysql-router]# vi mysqlrouter.ini</span><br><span class="line"></span><br><span class="line">[DEFAULT]              </span><br><span class="line">logging_folder=usr/local/mysql-router/logs                                                         </span><br><span class="line"></span><br><span class="line">[logger]                                                                  </span><br><span class="line">level=INFO                                                                                    </span><br><span class="line">[routing:basic_failover]                                                                              </span><br><span class="line">bind_address=192.168.1.186                                                                          </span><br><span class="line">bind_port=000                                                                                      </span><br><span class="line">destinations=192.168.1.189:3306                                                                     </span><br><span class="line">mode=read-write                                                                                     </span><br><span class="line">max_connections=1024                                                                                </span><br><span class="line">max_connect_errors=100                                                                              </span><br><span class="line">client_connect_timeout=9                                                                        </span><br><span class="line">[routing:balancing]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">绑定router的IP即可</span>                                               </span><br><span class="line">bind_address=192.168.1.186                                                #绑定端口                </span><br><span class="line">bind_port=8001                                                            #数据库地址，会轮训访问                      </span><br><span class="line">destinations = 192.168.1.193:3306</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定模式为只读</span></span><br><span class="line">mode=read-only                                                            #设置最大连接数        </span><br><span class="line">max_connections=65535</span><br><span class="line">max_connect_errors=100</span><br><span class="line">client_connect_timeout = 9            </span><br><span class="line">[keepalive]                                                               </span><br><span class="line">interval = 60</span><br></pre></td></tr></table></figure>

<p>以上是配置文件内容，注释了一部分</p>
<ul>
<li>启动mysqlrouter(设置自己的配置文件即可，我已经在配置文件目录了就按照下方启动即可)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql-router]# mysqlrouter -c ./mysqlrouter.ini &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>验证mysqlrouter是否启动（下图情况为启动成功）</li>
</ul>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql-router]# netstat -tunlp|grep mysqlrouter                               </span><br><span class="line">tcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN      71271/mysqlrouter     </span><br><span class="line">tcp        0      0 0.0.0.0:8001            0.0.0.0:*               LISTEN      71271/mysqlrouter</span><br></pre></td></tr></table></figure>

<p> 经过以上步骤已经完成router配置了，如果主库从库都可以的话即可使用客户端通过8000端口访问测试，如果不能访问通过下面这组命令查看错误日志</p>
 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost mysql-router]# tail logs/mysqlrouter.log</span><br></pre></td></tr></table></figure>

<p>2.Mysql Master 数据库主库</p>
<ul>
<li>配置从库复制账号</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">MySQL [(none)]&gt; grant replication scale on *.* to &#x27;账号名&#x27;@&#x27;主机域&#x27; identifed by &#x27;账号密码&#x27;；</span><br><span class="line">MySQL [(none)]&gt; flush privileges;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>配置主库的主从复制文件my.ini主要增加或修改一下选项</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">#服务器ID唯一标识，错了，无法复制</span><br><span class="line">server-id = 1</span><br><span class="line">#指定复制库</span><br><span class="line">binlog-do-db=text</span><br><span class="line">#以下数据库不复制</span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 经过修改以后从其mysql主库的任务就完成了，接下来配置从库</p>
<ol start="3">
<li>Mysql Salve 数据库从库(设定主库信息进行读写配置)</li>
</ol>
<p>登入数据库后查看服务器ID不可以和主库相同，切记！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MySQL [(none)]&gt; show variables like &#x27;server_id&#x27;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| server_id     | 2     |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>查询主库配置信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MySQL [(none)]&gt; show master status \G</span><br><span class="line"></span><br><span class="line">             File: mysql-bin.000006</span><br><span class="line">         Position: 2647</span><br><span class="line">     Binlog_Do_DB: text</span><br><span class="line"> Binlog_Ignore_DB: mysql</span><br><span class="line">Executed_Gtid_Set:</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>获取File和Position即可</p>
<p>写入主库信息</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MySQL [(none)]&gt; change master to</span><br><span class="line">    -&gt;master_host=&#x27;192.168.1.189&#x27;,//主库地址</span><br><span class="line">    -&gt;master_port=3306,          //主库端口      </span><br><span class="line">    -&gt;master_user=&#x27;master&#x27;,      //主库同步账户名             </span><br><span class="line">    -&gt;master_password=&#x27;master&#x27;,  //同步账号密码</span><br><span class="line">    -&gt;master_log_file=&#x27;mysql-bin.000005&#x27;,//对应主库File</span><br><span class="line">    -&gt;master_log_pos=3195;//对应主库Position                                                 </span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.02 sec)</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; start slave;   //启动同步</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>为了保证数据同步，请一定要空表操作，避免报错</p>
<p>如果同步请使用MySQL [(none)]&gt; show slave status \G 查看具体错误</p>
<p>其它从库全部遵循这个配置原则即可完成，多少个从库都可以</p>
<h3 id="五、-总结"><a href="#五、-总结" class="headerlink" title="五、 总结"></a>五、 总结</h3><p>通过本次学习我对数据库负载均衡有了很大的了解，我以后也会继续学习更深入的集群化知识，为以后架构师的梦想做知识筹备，也希望我出的这个经验分享能给大家一个很好的参考，也是目前能提高公司产品服务器这块速度慢，在并发情况下发生数据库罢工的解决方案，目前这个演示仅仅是一个主库和从库，大家回去练习可以多建立从库进行大并发访问测试，今天的分享就到这里，祝大家工作顺利。</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-07-28</span><i class="fa fa-tag"></i><a class="tag" href="/tags/mysql/" title="mysql">mysql </a><i class="fa fa-tag"></i><a class="tag" href="/tags/mysql-router/" title="mysql-router">mysql-router </a><span>About 1877 words, 6 min 15 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/07/26/2017-07-26-%E5%A5%BD%E4%B9%85%E6%B2%A1%E5%86%99%E5%8D%9A%E5%AE%A2%E4%BA%86/">好久没写博客了</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>转眼间我已经毕业了踏上了人生新的征程，大学这四年我每逢假期都会去做兼职，我做过的很多呢，卖冰激凌，烤鱿鱼，烤鱼片，爆米花冰激凌，快餐店的鲜榨果汁和汉堡等我都有触及，之前在大学觉得一点意思也没有，总是想出去工作，先自我毕业了也签工作，感受颇多，我想对我在公司的感受做一个总结吧。</p>
</blockquote>
<h3 id="初入职场"><a href="#初入职场" class="headerlink" title="初入职场"></a>初入职场</h3><p>  当我来到新公司一切幻想都是那么的美好，曾一度幻想着自己子公司发挥多大作用，出任CEO、赢取白富美、走上人生巅峰~</p>
<h3 id="入场三个月"><a href="#入场三个月" class="headerlink" title="入场三个月"></a>入场三个月</h3><p>  目前公司产品是考试培训系统，按照当今来说竞争真的非常激励了，公司使用的是之前来员工写的框架oFrame ，怎么说呢框架在八年前非常的厉害，给我的感觉和TP3时代的产物，公司老大安排我解决新题型的问题，目前把  考试系统面临新题型问题，我经过三天研究真的放弃了，真的代码太难维护了，毕竟那个年的产物没有命名空间什么的，而且更没有composer这样的先进版本管理的产物。</p>
<p>  目前我维护接口这块内容，因为接口和旧框架有很大的问题，比如数据都是SQL直接查询，大量的代码充斥着面临各种安全危机，xss，CSRF，SQL注入等常见漏洞比比皆是，系统内部饱含各种bug和问题。</p>
<p>  目前我的想法是先从我这里开刀动用现今的Laravel(PHP先进框架)  因为公司业务目前业务都是针对于客户主机获取内容，这次应对的目标是在未来ios的APP能够尽快完成出来让用户先用起来，没有办法我只能继续沿用致前任写的接口，尽快的赶工出来。</p>
<p>  在未来我做如下规划：<br>  Laravel负责基础框架快速完成平台化的工作<br>  docker 负责环境这块的配置达到运维一条命令即可完成部署<br>  radis  作为内存机数据库完成token这里快速查询修改<br>  mysql  作为主要数据来源，负责数据的持久化，这里我准备使用主从分离技术来完成<br>  centos 服务器这里统一采用centos免费的服务器系统</p>
<p>  以上是我的想法和规划，目前需要尽快出来的的版本这里为了能够尽快完成必须完成session集群化共享的内容，达到快速完成现有版本的实现。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>我会在接下来的日子继续学习，学习各种最新的架构，争取这一年能够自己独立完成php框架的学习和编写，在未来成为架构师的道路上继续努力。</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-07-26</span><i class="fa fa-tag"></i><a class="tag" href="/tags/博客感言/" title="博客感言">博客感言 </a><span>About 811 words, 2 min 42 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/05/19/2017-05-19-php%E6%96%87%E6%A1%A3%E6%B3%A8%E9%87%8A%E8%A7%84%E8%8C%83%E6%80%BB%E7%BB%93%E5%92%8C%E5%AD%A6%E4%B9%A0/">php文档注释规范总结和学习</a></h3></div><div class="post-content"><div class="card"><p><h3 id="PHP标准注释列表"><a href="#PHP标准注释列表" class="headerlink" title="PHP标准注释列表"></a>PHP标准注释列表</h3><ul>
<li><a href="#api" title="@api">@api</a></li>
<li><a href="#author" title="@author">@author</a></li>
<li><a href="#category" title="@category">@category</a></li>
<li><a href="#copyright" title="@copyright">@copyright</a></li>
<li><a href="#deprecated" title="@deprecated">@deprecated</a></li>
<li><a href="#example" title="@example">@example</a></li>
<li><a href="#filesource" title="@filesource">@filesource</a></li>
<li><a href="#global" title="@global">@global</a></li>
<li><a href="#ignore" title="@ignore">@ignore</a></li>
<li><a href="#internal" title="@internal">@internal</a></li>
<li><a href="#license" title="@license">@license</a></li>
<li><a href="#link" title="@link">@link</a></li>
<li><a href="#method" title="@method">@method</a></li>
<li><a href="#package" title="@package">@package</a></li>
<li><a href="#param" title="@param">@param</a></li>
<li><a href="#property-read" title="@property-read">@property-read</a></li>
<li><a href="#property-write" title="@property-write">@property-write</a></li>
<li><a href="#return" title="@return">@return</a></li>
<li><a href="#see" title="@see">@see</a></li>
<li><a href="#since" title="@since">@since</a></li>
<li><a href="#source" title="@source">@source</a></li>
<li><a href="#subpackage" title="@subpackage">@subpackage</a></li>
<li><a href="#throws" title="@throws">@throws</a></li>
<li><a href="#todo" title="@todo">@todo</a></li>
<li><a href="#uses" title="@uses">@uses</a></li>
<li><a href="#var" title="@vars">@var</a></li>
<li><a href="#version" title="@version">@version</a></li>
</ul>
<p><a id="api"><h3>@api </h3></a></p>
<ul>
<li>语法要求</li>
<li>官方示例如下：<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * This method will not change until a major release.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@api</span></span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showVersion</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">     &lt;...&gt;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a id="api"><h3>@author</h3></a></p>
<ul>
<li><p>语法要求</p>
<ul>
<li>@author [name] [<email address>]</li>
</ul>
</li>
<li><p>官方示例如下：</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@author</span> My Name</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@author</span> My Name &lt;my.name<span class="doctag">@example</span>.com&gt;</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>


<p><a id="category"><h3>@category</h3></a></p>
<ul>
<li><p>语法要求</p>
<ul>
<li>@category [description]</li>
</ul>
</li>
<li><p>官方示例</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Page-Level DocBlock</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@category</span> MyCategory</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@package</span>  MyPackage</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>



<p><a id="copyright"><h3>@copyright</h3></a></p>
<ul>
<li>语法要求<ul>
<li>@copyright [description]</li>
</ul>
</li>
<li>描述<ul>
<li>此注释专用于对软件版权进行注释</li>
</ul>
</li>
<li>官方示例<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@copyright</span> 1997-2005 The PHP Group</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><a id="deprecated"><h3>@deprecated</h3></a></p>
<ul>
<li><p>语法要求</p>
<ul>
<li>@deprecated [version] [description]</li>
</ul>
</li>
<li><p>官方示例</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@deprecated</span></span></span><br><span class="line"><span class="comment">* <span class="doctag">@deprecated</span> 1.0.0</span></span><br><span class="line"><span class="comment">* <span class="doctag">@deprecated</span> No longer used by internal code and not recommended.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@deprecated</span> 1.0.0 No longer used by internal code and not recommended.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  &lt;...&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a id="example"><h3>@example</h3></a></p>
<ul>
<li><p>语法要求</p>
<ul>
<li>@example [location] [start-line] [number-of-lines] ] [description]</li>
</ul>
</li>
<li><p>官方示例</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@example</span> example1.php Counting in action.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@example</span> http://example.com/example2.phps Counting in action by a 3rd party.</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@example</span> &quot;My Own Example.php&quot; My counting.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">     &lt;...&gt;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a id="filesource"><h3>@filesource</h3></a></p>
<blockquote>
<p>@filesource标签用于告诉phpDocumentor将当前文件的源包含在解析结果中。</p>
</blockquote>
<ul>
<li><p>语法要求</p>
<ul>
<li>@filesource</li>
</ul>
</li>
<li><p>说明<br>@filesource标签告诉phpDocumentor将当前文件包含在解析输出中。由于这仅适用于整个文件的源代码，所以必须在文件级PHPDoc中使用此标记。任何其他位置都将被忽略。</p>
<p>当包含此标签时，phpDocumentor将压缩文件内容并使用Base64进行编码，以便可以由变压器处理。任何能够显示源代码的模板都可以在抽象语法树中读取相关文件元素中的源子元素。</p>
</li>
<li><p>官方示例</p>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/ **</span><br><span class="line">  * @filesource</span><br><span class="line">  * /</span><br></pre></td></tr></table></figure>


<p><a id="global"><h3>@global</h3></a></p>
<blockquote>
<p>@global标签用于通知phpDocumentor全局变量_or_其用法。(非必须)</p>
</blockquote>
<ul>
<li>语法要求</li>
</ul>
<ul>
<li>@global [ Type ] [name] @global [ Type ] [description]</li>
</ul>
<hr>
<p><a id="ignore"><h3>@ignore</h3></a></p>
<blockquote>
<p>@ignore标签用于告诉phpDocumentor结构元素不被phpDocumentor处理。</p>
</blockquote>
<ul>
<li>语法要求<ul>
<li>@ignore [<description>]</li>
</ul>
</li>
<li>官方示例</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>（$ ostest）&#123;</span><br><span class="line">     / **</span><br><span class="line">      *这个定义将是“Unix”或“Windows”</span><br><span class="line">      * /</span><br><span class="line">     define（“OS”，“Unix”）;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     / **</span><br><span class="line">      * @ignore</span><br><span class="line">      * /</span><br><span class="line">     define（“OS”，“Windows”）;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><a id="api"><h3>@api</h3></a></p>
<ul>
<li>语法要求</li>
<li>官方示例</li>
</ul>
<hr>
<p><a id="api"><h3>@api</h3></a></p>
<ul>
<li>语法要求</li>
<li>官方示例</li>
</ul>
<p><a id="api"><h3>@api</h3></a></p>
<ul>
<li>语法要求</li>
<li>官方示例</li>
</ul>
<p><a id="api"><h3>@api</h3></a></p>
<ul>
<li>语法要求</li>
<li>官方示例</li>
</ul>
<p><a id="api"><h3>@api</h3></a></p>
<ul>
<li>语法要求</li>
<li>官方示例</li>
</ul>
<p><a id="api"><h3>@api</h3></a></p>
<ul>
<li>语法要求</li>
<li>官方示例</li>
</ul>
<p><a id="api"><h3>@api</h3></a><br><a id="api"><h3>@api</h3></a><br><a id="api"><h3>@api</h3></a></p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-05-19</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP/" title="PHP">PHP </a><i class="fa fa-tag"></i><a class="tag" href="/tags/web/" title="web">web </a><i class="fa fa-tag"></i><a class="tag" href="/tags/apidoc/" title="apidoc">apidoc </a><span>About 556 words, 1 min 51 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/05/17/2017-05-17-Larvel%E5%AD%A6%E4%B9%A0-%EF%BC%88Day-02%EF%BC%89/">Larvel学习 （Day 02）</a></h3></div><div class="post-content"><div class="card"><p><ul>
<li><p><strong>Larvel</strong> 服务容器学习</p>
<blockquote>
<p>一个好的系统并不在代码多么复杂，框架多么多么大，在我的理解中框架跑得快不一定成功，不跌跟头才叫赢。</p>
</blockquote>
<p>我们需要弄懂这么几个概念：依赖注入，服务容器</p>
<ul>
<li><p><strong>依赖注入:</strong> 这是一个花哨的名词，其实质上是通过【<strong>构造方法</strong>】或者【<strong>setter</strong>】来对本类中需要用到的以来进行注入。</p>
<p>下面是官方的样例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">UserRepository</span>;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * User Repository 的实现。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> UserRepository</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$users</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建新的控制器实例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  UserRepository  $users</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">UserRepository <span class="variable">$users</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;users = <span class="variable">$users</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示指定用户的详细信息。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="variable language_">$this</span>-&gt;users-&gt;<span class="title function_ invoke__">find</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;user.profile&#x27;</span>, [<span class="string">&#x27;user&#x27;</span> =&gt; <span class="variable">$user</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>讲解：<br>在这个例子中，控制器 UserController 需要从数据源中获取 users 。<br>因此，我们要 注入 可以获取 users 的服务。<br>在这种情况下， UserRepository 可能是通过使用 Eloquent 来从数据库中获取 user 信息。<br>因为 UserRepository 是通过注入获取，所以我们可以容易地切换为其他实现。当测试应用程序时，我们还可以轻松地 「mock」 ，或创建假的 UserRepository 实例。</p>
</li>
<li><p><strong>服务容器:</strong>  管理类的以来和运行依赖注入的有效管理工具,</p>
<p>Laravel服务容器主要承担两个作用：绑定与解析，服务容器的结构如下：</p>
<p>  <img src="http://img.yuekang.org.cn/2017051701.jpg" alt="服务容器"></p>
</li>
</ul>
</li>
</ul>
<h4 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h4><p>  <em>所谓的绑定就是将接口与实现建立对应关系。几乎所有的服务容器绑定都是在服务提供者中完成，也就是在服务提供者中绑定。</em></p>
<blockquote>
<p>如果一个类没有基于任何接口那么就没有必要将其绑定到容器。容器并不需要被告知如何构建对象，因为它会使用 PHP 的反射服务自动解析出具体的对象。</p>
</blockquote>
<p>  也就是说，如果需要依赖注入的外部资源如果没有接口，那么就不需要绑定，直接利用服务容器进行解析就可以了，服务容器会根据类名利用反射对其进行自动构造。</p>
<ul>
<li><p>bind绑定</p>
<p> 绑定有多种方法，首先最常用的是bind函数的绑定</p>
<ul>
<li><p>绑定自身</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;App\Services\RedisEventPusher&#x27;</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>绑定闭包</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;HelpSpot\API&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelpSpot</span>\<span class="title function_ invoke__">API</span>();</span><br><span class="line">&#125;);<span class="comment">//闭包直接提供实现方式</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;HelpSpot\API&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelpSpot</span>\<span class="title function_ invoke__">API</span>(<span class="variable">$app</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;HttpClient&#x27;</span>));</span><br><span class="line">&#125;);<span class="comment">//需要依赖注入</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>绑定接口</p>
</li>
</ul>
 <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(</span><br><span class="line">    <span class="string">&#x27;App\Contracts\EventPusher&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;App\Services\RedisEventPusher&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>singleton绑定</p>
<p>singleton 方法绑定一个只需要解析一次的类或接口到容器，然后接下来对容器的调用将会返回同一个实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">singleton</span>(<span class="string">&#x27;HelpSpot\API&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelpSpot</span>\<span class="title function_ invoke__">API</span>(<span class="variable">$app</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;HttpClient&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>instance绑定</p>
<p>我们还可以使用 instance 方法绑定一个已存在的对象实例到容器，随后调用容器将总是返回给定的实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$api</span> = <span class="keyword">new</span> <span class="title class_">HelpSpot</span>\<span class="title function_ invoke__">API</span>(<span class="keyword">new</span> <span class="title class_">HttpClient</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">instance</span>(<span class="string">&#x27;HelpSpot\Api&#x27;</span>, <span class="variable">$api</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Context绑定</p>
<p>有时侯我们可能有两个类使用同一个接口，但我们希望在每个类中注入不同实现，例如，两个控制器依赖 Illuminate\Contracts\Filesystem\Filesystem 契约的不同实现。Laravel 为此定义了简单、平滑的接口：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Storage</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">VideoController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">PhotoControllers</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Filesystem</span>\<span class="title">Filesystem</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">when</span>(<span class="title class_">StorageController</span>::<span class="variable language_">class</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">needs</span>(<span class="title class_">Filesystem</span>::<span class="variable language_">class</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">give</span>(function () &#123;</span><br><span class="line">          <span class="title class_">Storage</span>::<span class="variable language_">class</span></span><br><span class="line">        &#125;);<span class="comment">//提供类名</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">when</span>(<span class="title class_">PhotoController</span>::<span class="variable language_">class</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">needs</span>(<span class="title class_">Filesystem</span>::<span class="variable language_">class</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">give</span>(function () &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Storage</span>();</span><br><span class="line">        &#125;);<span class="comment">//提供实现方式</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">when</span>(<span class="title class_">VideoController</span>::<span class="variable language_">class</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">needs</span>(<span class="title class_">Filesystem</span>::<span class="variable language_">class</span>)</span><br><span class="line">        -&gt;<span class="title function_ invoke__">give</span>(function () &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Storage</span>(<span class="variable">$app</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="title class_">Disk</span>::<span class="variable language_">class</span>));</span><br><span class="line">        &#125;);<span class="comment">//需要依赖注入</span></span><br></pre></td></tr></table></figure></li>
<li><p>原始值绑定<br>  我们可能有一个接收注入类的类，同时需要注入一个原生的数值比如整型，可以结合上下文轻松注入这个类需要的任何值：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">when</span>(<span class="string">&#x27;App\Http\Controllers\UserController&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">needs</span>(<span class="string">&#x27;$variableName&#x27;</span>)</span><br><span class="line">    -&gt;<span class="title function_ invoke__">give</span>(<span class="variable">$value</span>);</span><br></pre></td></tr></table></figure>

</li>
<li><p>数组绑定</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">app</span>()[<span class="string">&#x27;service&#x27;</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Service</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>标签绑定</p>
<p>少数情况下，我们需要解析特定分类下的所有绑定，例如，你正在构建一个接收多个不同 Report 接口实现的报告聚合器，在注册完 Report 实现之后，可以通过 tag 方法给它们分配一个标签：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">  <span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;SpeedReport&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;MemoryReport&#x27;</span>, function () &#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">tag</span>([<span class="string">&#x27;SpeedReport&#x27;</span>, <span class="string">&#x27;MemoryReport&#x27;</span>], <span class="string">&#x27;reports&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>这些服务被打上标签后，可以通过 tagged 方法来轻松解析它们：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;ReportAggregator&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReportAggregator</span>(<span class="variable">$app</span>-&gt;<span class="title function_ invoke__">tagged</span>(<span class="string">&#x27;reports&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>extend扩展</p>
<p>extend是在当原来的类被注册或者实例化出来后，可以对其进行扩展：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testExtendInstancesArePreserved</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="variable">$container</span> = <span class="keyword">new</span> <span class="title class_">Container</span>;</span><br><span class="line">  <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;foo&#x27;</span>, function () &#123;</span><br><span class="line">      <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">StdClass</span>;</span><br><span class="line">      <span class="variable">$obj</span>-&gt;foo = <span class="string">&#x27;bar&#x27;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="variable">$obj</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">StdClass</span>;</span><br><span class="line">  <span class="variable">$obj</span>-&gt;foo = <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">  <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">instance</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="variable">$obj</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;foo&#x27;</span>, function (<span class="variable">$obj</span>, <span class="variable">$container</span>) &#123;</span><br><span class="line">      <span class="variable">$obj</span>-&gt;bar = <span class="string">&#x27;baz&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable">$obj</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">extend</span>(<span class="string">&#x27;foo&#x27;</span>, function (<span class="variable">$obj</span>, <span class="variable">$container</span>) &#123;</span><br><span class="line">      <span class="variable">$obj</span>-&gt;baz = <span class="string">&#x27;foo&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable">$obj</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assertEquals</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;foo&#x27;</span>)-&gt;foo);</span><br><span class="line">  <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assertEquals</span>(<span class="string">&#x27;baz&#x27;</span>, <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;foo&#x27;</span>)-&gt;bar);</span><br><span class="line">  <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assertEquals</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="variable">$container</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;foo&#x27;</span>)-&gt;baz);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Rebounds与Rebinding</p>
<p>绑定是针对接口的，是为接口提供实现方式的方法。我们可以对接口在不同的时间段里提供不同的实现方法，一般来说，对同一个接口提供新的实现方法后，不会对已经实例化的对象产生任何影响。但是在一些场景下，在提供新的接口实现后，我们希望对已经实例化的对象重新做一些改变，这个就是 rebinding 函数的用途。<br>下面就是一个例子：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Fuel <span class="variable">$fuel</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;fuel = <span class="variable">$fuel</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">refuel</span>(<span class="params"><span class="variable">$litres</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable">$litres</span> * <span class="variable language_">$this</span>-&gt;fuel-&gt;<span class="title function_ invoke__">getPrice</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setFuel</span>(<span class="params">Fuel <span class="variable">$fuel</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;fuel = <span class="variable">$fuel</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JeepWrangler</span> <span class="keyword">extends</span> <span class="title">Car</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Fuel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrice</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Petrol</span> <span class="keyword">implements</span> <span class="title">Fuel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPrice</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">130.7</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>我们在服务容器中是这样对car接口和fuel接口绑定的：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;fuel&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Petrol</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;car&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JeepWrangler</span>(<span class="variable">$app</span>[<span class="string">&#x27;fuel&#x27;</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">make</span>(<span class="string">&#x27;car&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>如果car被服务容器解析实例化成对象之后，有人修改了 fuel 接口的实现，从 Petrol 改为 PremiumPetrol：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bind</span>(<span class="string">&#x27;fuel&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PremiumPetrol</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>由于 car 已经被实例化，那么这个接口实现的改变并不会影响到 car 的实现，假若我们想要 car 的成员变量 fuel 随着 fuel 接口的变化而变化，我们就需要一个回调函数，每当对 fuel 接口实现进行改变的时候，都要对 car 的 fuel 变量进行更新，这就是 rebinding 的用途：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;app-&gt;<span class="title function_ invoke__">bindShared</span>(<span class="string">&#x27;car&#x27;</span>, function (<span class="variable">$app</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JeepWrangler</span>(<span class="variable">$app</span>-&gt;<span class="title function_ invoke__">rebinding</span>(<span class="string">&#x27;fuel&#x27;</span>, function (<span class="variable">$app</span>, <span class="variable">$fuel</span>) &#123;</span><br><span class="line">      <span class="variable">$app</span>[<span class="string">&#x27;car&#x27;</span>]-&gt;<span class="title function_ invoke__">setFuel</span>(<span class="variable">$fuel</span>);</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>今天先到这里，未来会继续学习和总结。</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-05-17</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP/" title="PHP">PHP </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Larvel/" title="Larvel">Larvel </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Web/" title="Web">Web </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Framwork/" title="Framwork">Framwork </a><span>About 1883 words, 6 min 16 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/05/10/2017-05-10-%E5%AD%A6%E4%B9%A0Larvel-Day-1/">学习Larvel(Day 1)</a></h3></div><div class="post-content"><div class="card"><p><h3 id="今天开始博主要开始学习Larvel啦并将他用在实际的项目中去"><a href="#今天开始博主要开始学习Larvel啦并将他用在实际的项目中去" class="headerlink" title="今天开始博主要开始学习Larvel啦并将他用在实际的项目中去"></a>今天开始博主要开始学习Larvel啦并将他用在实际的项目中去</h3><p>一、 目录结构</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /               根目录</span></span><br><span class="line">  |--- app        应用目录(包含应用程序的核心代码)</span><br><span class="line">        |--- Console          包含应用所有自定义的 Artisan 命令</span><br><span class="line">        |--- Events           用来放置 事件类 的</span><br><span class="line">        |--- Exceptions       应用的异常处理</span><br><span class="line">        |--- Http             包含你的控制器、中间件和请求</span><br><span class="line">        |--- Jobs             用于存放 队列任务(在你执行 make:job 命令生成任务类时，才会出现)</span><br><span class="line">        |--- Listeners</span><br><span class="line">        |--- Mail             邮件发送类(默认不存在，但是可以通过执行 make:mail 命令生成，Mail 目录包含邮件发送类，邮件对象允许你在一个地方封装构建邮件所需的所有业务逻辑，然后使用 <span class="title class_">Mail</span>::<span class="variable constant_">send</span> 方法发送邮件。)</span><br><span class="line">        |--- Notifications    包含应用发送的所有通知，比如事件发生通知（目录默认不存在，你可以通过执行 make:notification 命令创建， ）</span><br><span class="line">        |--- Policies         包含了所有的授权策略类（通过执行 ·make:policy· 命令来创建）</span><br><span class="line">        |--- Providers        包含应用的 服务提供者 （Providers 目录包含应用的 服务提供者 。服务提供者在启动应用过程中绑定服务到容器、注册事件，以及执行其他任务，为即将到来的请求处理做准备。）</span><br><span class="line">  |--- bootstrap  引导目录(目录包含了几个框架启动和自动加载设置的文件)</span><br><span class="line">        |--- <span class="title function_ invoke__">cache</span> (包含框架为提升性能所生成的文件，如路由和服务缓存文件)</span><br><span class="line">  |--- config     配置文件</span><br><span class="line">  |--- database   数据库(包含了数据迁移及填充文件)</span><br><span class="line">  |--- <span class="keyword">public</span>     包含了 Laravel 的 HTTP 入口文件 index.php 和前端资源文件（图片、JavaScript、CSS等）</span><br><span class="line">  |--- resources  资源目录（包含了视图、原始的资源文件 (LESS、SASS、CoffeeScript) ，以及语言包。）</span><br><span class="line">  |--- routes     路由目录（包含了应用的所有路由定义）</span><br><span class="line">  |--- storage    包含编译后的 Blade 模板、基于文件的 session、文件缓存和其它框架生成的文件</span><br><span class="line">        |--- app        用于存储应用程序使用的任何文件</span><br><span class="line">        |--- framework  目录被用于保存框架生成的文件及缓存</span><br><span class="line">        |--- logs        目录包含了应用程序的日志文件</span><br><span class="line">  |--- tests      包含自动化测试</span><br><span class="line">  |--- vendor     包含所有 Composer 依赖</span><br></pre></td></tr></table></figure>

<h4 id="请求的整体流程"><a href="#请求的整体流程" class="headerlink" title="请求的整体流程"></a>请求的整体流程</h4><blockquote>
<p>larvel的请求入口是public&#x2F;index.PHP,我们在开始部署的时候不管你用的是apache还是nginx都会指向这个文件，这是程序的入口。</p>
</blockquote>
<ol>
<li>public&#x2F;index.php 文件</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| 注册自定义加载类</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../bootstrap/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| 引入Larvel应用实例（composer生成的自定义加载器定义）</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span> = <span class="keyword">require_once</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../bootstrap/app.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| 创建一个自身应用实例（[服务容器](https://docs.golaravel.com/docs/5.4/container/)）</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable">$kernel</span> = <span class="variable">$app</span>-&gt;<span class="title function_ invoke__">make</span>(<span class="title class_">Illuminate\Contracts\Http\Kernel</span>::<span class="variable language_">class</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = <span class="variable">$kernel</span>-&gt;<span class="title function_ invoke__">handle</span>(</span><br><span class="line">  <span class="variable">$request</span> = <span class="title class_">Illuminate\Http\Request</span>::<span class="title function_ invoke__">capture</span>()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span>-&gt;<span class="title function_ invoke__">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$kernel</span>-&gt;<span class="title function_ invoke__">terminate</span>(<span class="variable">$request</span>, <span class="variable">$response</span>);</span><br></pre></td></tr></table></figure>

<p>以上是初步分析，后续会继续跟进，大家可以多提提意见，让我成长更快~</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-05-10</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP/" title="PHP">PHP </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Larvel/" title="Larvel">Larvel </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Web/" title="Web">Web </a><span>About 789 words, 2 min 37 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/04/17/2017-04-17-%E5%AE%9E%E7%8E%B0SOAP%E6%8E%A5%E5%8F%A3%E5%BE%97%E9%80%82%E9%85%8D/">实现SOAP接口得适配</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>博主工作一周了，上一周里遇到了一个难题，就是对方提供的是SOAP协议制作出来的接口，让我们进行适配，其实这个技术已经淘汰了，不过对方是erp也不可能因为你而改写什么对吧，这里我们就分析一下怎么解决这个问题。</p>
</blockquote>
<h2 id="SOAP（Simple-Object-Access-Protocol）-简单对象访问协议"><a href="#SOAP（Simple-Object-Access-Protocol）-简单对象访问协议" class="headerlink" title="SOAP（Simple Object Access Protocol） 简单对象访问协议"></a>SOAP（Simple Object Access Protocol） 简单对象访问协议</h2><blockquote>
<p>SOAP是基于XML的建议协议，可使用应用程序的HTTP之上进行信息交换或简单地说：SOAP使用用于访问网络服务的协议。</p>
</blockquote>
<ol>
<li>什么是SOAP？</li>
</ol>
<ul>
<li>SOAP 指__简易对象访问协议__</li>
<li>SOAP 是一种__通信协议__</li>
<li>SOAP 用于__应用程序之间__的通信</li>
<li>SOAP 是一种__发送消息__的格式</li>
<li>SOAP 被设计用来__通过因特网__进行通信</li>
<li>SOAP <strong>独立于平台</strong></li>
<li>SOAP <strong>独立于语言</strong></li>
<li>SOAP <strong>基于XML</strong></li>
<li>SOAP <strong>很简单并可扩展</strong></li>
<li>SOAP 允许你__绕过防火墙__</li>
<li>SOAP 将被作为__W3C标准__来发展</li>
</ul>
<ol start="2">
<li><img src="http://img.yuekang.org.cn/2017041701.gif" alt="SOAP"></li>
</ol>
<p>6.约定的交互格式交互格式</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> <span class="attr">xmlns:sen</span>=<span class="string">&quot;http://pi.want-want.com/ZRFCARW_1/Sender_Syn&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">soapenv:Header</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">soapenv:Body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sen:MT_ZRFCARW01_Req</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--Optional:--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">IM_OBJID</span>&gt;</span>&#123;json数据&#125;<span class="tag">&lt;/<span class="name">IM_OBJID</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">sen:MT_ZRFCARW01_Req</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">soapenv:Body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">soapenv:Envelope</span> <span class="attr">xmlns:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> <span class="attr">xmlns:sen</span>=<span class="string">&quot;http://pi.want-want.com/ZRFCARW_2/Sender_Syn&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">soapenv:Header</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">soapenv:Body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sen:MT_ZRFCARW02_Req</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--Optional:--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">IM_JSON</span>&gt;</span>&#123;json数据&#125;<span class="tag">&lt;/<span class="name">IM_JSON</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">sen:MT_ZRFCARW02_Req</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">soapenv:Body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">soapenv:Envelope</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="7">
<li>鉴权方式<br>– BaseAuthor验证方式</li>
</ol>
<hr>
<h5 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h5><ol>
<li>通过对方提供wsdl文档文件，使用soapUI软件进行测试解析</li>
</ol>
<ul>
<li>soapUI工具图：</li>
</ul>
<p><img src="http://img.yuekang.org.cn/2017042101.png" alt="soapUI工具图"></p>
<blockquote>
<p>当我们使用这个工具跑通接口后，这个时候还没有完成我们还必须要使用一个工具就是postman这个接口测试工具，有人可能要问了，为啥用soapui这个工具呢？答案是：交互数据接口，我们需要读取wsdl文件啊，才能知道交互的数据结构呢。</p>
</blockquote>
<ol start="2">
<li>使用postman软件进行接口的再次测试。</li>
</ol>
<ul>
<li>从soapUI中获取相关信息进行解析使用postman进行测试</li>
</ul>
<p><img src="http://img.yuekang.org.cn/2017042103.jpg" alt="测试图1"></p>
<ul>
<li>填入交互数据</li>
</ul>
<p><img src="http://img.yuekang.org.cn/2017042104.jpg" alt="交互数据图"></p>
<ul>
<li>返回的结果图</li>
</ul>
<p><img src="http://img.yuekang.org.cn/2017042102.jpg" alt="返回结果图"></p>
<blockquote>
<p>我们获取到了正式的数据，我们还需要提取xml中的json数据，我得解决方案是通过正则匹配的形式提取json，还有另一种办法，因为数据的格式还是比较简单的，也可以采取替换的原则，去掉json的前后无用的xml标签数据</p>
</blockquote>
<hr>
<h6 id="一下是我写的通信代码"><a href="#一下是我写的通信代码" class="headerlink" title="一下是我写的通信代码"></a>一下是我写的通信代码</h6><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ApiNetManager</span>(<span class="params"><span class="variable">$json</span> = <span class="literal">null</span>, <span class="variable">$isID</span> = <span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//根地址</span></span><br><span class="line">    <span class="variable">$baseUrl</span> = <span class="string">&#x27;url&#x27;</span>;</span><br><span class="line">    <span class="variable">$port</span> = <span class="string">&#x27;port&#x27;</span>;</span><br><span class="line">    <span class="variable">$username</span> = <span class="string">&#x27;username&#x27;</span>;</span><br><span class="line">    <span class="variable">$password</span> = <span class="string">&#x27;password&#x27;</span>;</span><br><span class="line">    <span class="comment">//统一消息返回格式</span></span><br><span class="line">    <span class="variable">$info</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;code&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;data&#x27;</span> =&gt; <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//验证json的正确性</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>))) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构建网络请求</span></span><br><span class="line">    <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$isID</span>) &#123;<span class="comment">//验证课程ID</span></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt_array</span>(<span class="variable">$curl</span>, <span class="keyword">array</span>(</span><br><span class="line">            CURLOPT_PORT =&gt; <span class="variable">$port</span>,</span><br><span class="line">            CURLOPT_URL =&gt; <span class="variable">$baseUrl</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$port</span> . <span class="string">&quot;/XISOAPAdapter/MessageServlet?senderParty=&amp;senderService=BC_OEXAM&amp;receiverParty=&amp;receiverService=&amp;interface=SI_ZRFCARW01_Out_Syn&amp;interfaceNamespace=http%3A%2F%2Fpi.want-want.com%2FZRFCARW_1%2FSender_Syn&quot;</span>,</span><br><span class="line">            CURLOPT_RETURNTRANSFER =&gt; <span class="literal">true</span>,</span><br><span class="line">            CURLOPT_ENCODING =&gt; <span class="string">&quot;utf8&quot;</span>,</span><br><span class="line">            CURLOPT_MAXREDIRS =&gt; <span class="number">10</span>,</span><br><span class="line">            CURLOPT_TIMEOUT =&gt; <span class="number">30</span>,</span><br><span class="line">            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,</span><br><span class="line">            CURLOPT_CUSTOMREQUEST =&gt; <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            CURLOPT_POSTFIELDS =&gt; <span class="string">&quot;&lt;soapenv:Envelope xmlns:soapenv=\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot; xmlns:sen=\&quot;http://pi.want-want.com/ZRFCARW_1/Sender_Syn\&quot;&gt;&lt;soapenv:Header/&gt;&lt;soapenv:Body&gt;&lt;sen:MT_ZRFCARW01_Req&gt;&lt;IM_OBJID&gt;<span class="subst">&#123;$json&#125;</span>&lt;/IM_OBJID&gt;&lt;/sen:MT_ZRFCARW01_Req&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;&quot;</span>,</span><br><span class="line">            CURLOPT_HTTPHEADER =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;authorization: Basic &quot;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$username</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$password</span>),</span><br><span class="line">                <span class="string">&quot;cache-control: no-cache&quot;</span>,</span><br><span class="line">                <span class="string">&quot;content-type: application/xml&quot;</span>,</span><br><span class="line">            ),</span><br><span class="line">        ));</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//回传考试成绩接口</span></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt_array</span>(<span class="variable">$curl</span>, <span class="keyword">array</span>(</span><br><span class="line">            CURLOPT_PORT =&gt; <span class="string">&quot;50000&quot;</span>,</span><br><span class="line">            CURLOPT_URL =&gt; <span class="variable">$baseUrl</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$port</span> . <span class="string">&quot;/XISOAPAdapter/MessageServlet?senderParty=&amp;senderService=BC_OEXAM&amp;receiverParty=&amp;receiverService=&amp;interface=SI_ZRFCARW02_Out_Syn&amp;interfaceNamespace=http%3A%2F%2Fpi.want-want.com%2FZRFCARW_2%2FSender_Syn&quot;</span>,</span><br><span class="line">            CURLOPT_RETURNTRANSFER =&gt; <span class="literal">true</span>,</span><br><span class="line">            CURLOPT_ENCODING =&gt; <span class="string">&quot;&quot;</span>,</span><br><span class="line">            CURLOPT_MAXREDIRS =&gt; <span class="number">10</span>,</span><br><span class="line">            CURLOPT_TIMEOUT =&gt; <span class="number">30</span>,</span><br><span class="line">            CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,</span><br><span class="line">            CURLOPT_CUSTOMREQUEST =&gt; <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            CURLOPT_POSTFIELDS =&gt; <span class="string">&quot;&lt;soapenv:Envelope xmlns:soapenv=\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot; xmlns:sen=\&quot;http://pi.want-want.com/ZRFCARW_2/Sender_Syn\&quot;&gt;&lt;soapenv:Header/&gt;&lt;soapenv:Body&gt;&lt;sen:MT_ZRFCARW02_Req&gt;&lt;IM_JSON&gt;<span class="subst">&#123;$json&#125;</span>&lt;/IM_JSON&gt;&lt;/sen:MT_ZRFCARW02_Req&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;&quot;</span>,</span><br><span class="line">            CURLOPT_HTTPHEADER =&gt; <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;authorization: Basic &quot;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$username</span> . <span class="string">&#x27;:&#x27;</span> . <span class="variable">$password</span>),</span><br><span class="line">                <span class="string">&quot;cache-control: no-cache&quot;</span>,</span><br><span class="line">                <span class="string">&quot;content-type: application/xml&quot;</span>,</span><br><span class="line">            ),</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行网络请求</span></span><br><span class="line">    <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">    <span class="variable">$err</span> = <span class="title function_ invoke__">curl_error</span>(<span class="variable">$curl</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$err</span>) &#123;</span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span>;</span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;message&#x27;</span>] = <span class="string">&#x27;服务器异常，请稍后再试&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$response</span>, <span class="string">&#x27;&lt;title&gt;Error Report&lt;/title&gt;&#x27;</span>)) &#123;<span class="comment">//请求成功权限没有通过</span></span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;code&#x27;</span>] = <span class="number">302</span>;</span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;message&#x27;</span>] = <span class="string">&#x27;服务器请求权限未通过请联系管理员!&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//请求并权限通过</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$isID</span>) &#123;<span class="comment">//验证课程id的json查找</span></span><br><span class="line">            <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#123;.+&#125;/&quot;</span>, <span class="variable">$response</span>, <span class="variable">$match</span>);<span class="comment">//查找json</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//考试成绩回传的json查找</span></span><br><span class="line">            <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\[&#123;.*?\&#125;]/is&#x27;</span>, <span class="variable">$response</span>, <span class="variable">$match</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$jsonArr</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$match</span>[<span class="number">0</span>], <span class="literal">true</span>);<span class="comment">//解析json</span></span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span>;</span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;message&#x27;</span>] = <span class="string">&#x27;请求成功，成功返回数据&#x27;</span>;</span><br><span class="line">        <span class="variable">$info</span>[<span class="string">&#x27;data&#x27;</span>] = <span class="variable">$jsonArr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$info</span>[<span class="string">&#x27;code&#x27;</span>] == <span class="number">0</span> ? <span class="literal">false</span> : <span class="variable">$info</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>至此我们完成了数据的代码的填写，相关具体测试我就不多说了，这里我加入了标准的接口返回形式，一边后续的代码可以更加精确地判断问题出在哪里，好了就到这里，谢谢大家的观看。</p>
</blockquote>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-04-17</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP/" title="PHP">PHP </a><span>About 1396 words, 4 min 39 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/03/30/2017-03-30-%E7%BB%99%E5%AE%9A%E8%B7%AF%E5%BE%84%E7%BB%9F%E8%AE%A1%E5%BD%93%E5%89%8D%E4%BB%A5%E5%8F%8A%E5%AD%90%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E4%B8%AA%E6%95%B0/">给定路径统计当前以及子目录文件个数</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>可能是紧张的关系，当时大脑一片空白，没有想到解题思路，今天一起过来学习一下</p>
</blockquote>
<p>遇到一个问题前咱们必须先仔细的想想思路</p>
<ol>
<li>首先判断当前给定的路径是否是文件</li>
<li>文件则统计，目录则取出子目录进行递归</li>
<li>一轮统计结束后即可输出结果</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统计路径包括子目录的文件数量</span></span><br><span class="line"><span class="comment"> * Created by teddy on 2017/3/29.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUtils</span>  &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">(String path)</span>&#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path);</span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory())&#123;</span><br><span class="line">            File[] files = file.listFiles();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">                getCount(files[i].getPath());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试运行：<br>  准备目录和文件<br>  <img src="http://img.yuekang.org.cn/20170330204434.png" alt="根目录文件结构"></p>
<p>  <img src="http://img.yuekang.org.cn/20170330204443.png" alt="子目录文件结构"></p>
<p>运行结果：<br><img src="http://img.yuekang.org.cn/20170330204702.png" alt="运行结果图"></p>
<blockquote>
<p>之前一直没有去联系过相关的题目，造成了我笔试的失力，所以基础不扎实，这点一定要堵住，也希望大家也多加练习，在未来能写出一手漂亮的程序！</p>
</blockquote>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-03-30</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Java/" title="Java">Java </a><span>About 246 words, 49 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/03/28/2017-03-28-%E9%9D%A2%E8%AF%95%E7%BB%8F%E9%AA%8C1/">面试经验1</a></h3></div><div class="post-content"><div class="card"><p><h1 id="经验分享"><a href="#经验分享" class="headerlink" title="经验分享"></a>经验分享</h1><blockquote>
<p>  面临大学的毕业，我和大多数毕业生一样，对这个世界是那么的迷茫和无知，如今找工作也快一个月了，依然任何的进展，北京这个地方固然美好，但是人才济济，Android市场的异常冷门让我雪上加霜，貌似我现在连一个实习生的资格都过不了，我是该好好反思自己的水平，不能再停留在原来那个阶段，下面我总结几个我考过的题型，也是为了分享一下记录自己的不足好去应对未来的挑战。</p>
</blockquote>
<ul>
<li>实现一个单例模式代码</li>
</ul>
<blockquote>
<p>这道题虽然简单，但是埋下了一个坑，你是否考虑过在多线程的情况下，你得单例会不会产生多个对象呢？ 还有效率问题呢？</p>
</blockquote>
<ol>
<li>下面是一个简单的单例，咱们看看会产生什么问题<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="comment">//存放引用的变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">A</span> <span class="variable">ins</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//私有化构造方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">A</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> A <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ins == <span class="literal">null</span>)&#123;</span><br><span class="line">            ins = <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ins;</span><br><span class="line">    &#125;</span><br><span class="line">｝</span><br></pre></td></tr></table></figure></li>
</ol>
<p>实验效果：<br>  <img src="http://img.yuekang.org.cn/20170330145606.png" alt="效果图"></p>
<blockquote>
<p>哇，居然在高并发的情况下创建了两个！所以这种单例不严谨，会在高并发的情况下产生问题，我们来改进一下加入同步的内容。</p>
</blockquote>
<p>2.修改上面的代码加入同步的内容</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="comment">//存放引用的变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">A</span> <span class="variable">ins</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//私有化构造方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">A</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> A <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ins == <span class="literal">null</span>)&#123;</span><br><span class="line">           ins = <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ins;</span><br><span class="line">    &#125;</span><br><span class="line">｝</span><br></pre></td></tr></table></figure>

<p>实验效果图：<br><img src="http://img.yuekang.org.cn/20170330162133.png" alt="增加同步后的实验效果图"></p>
<blockquote>
<p>哇塞，达到了同步的效果，但是这里还需要注意一个问题就是，当我们在进行大量的并发的时候锁住了这个类以后是不是全部都需要进入锁判断了？ 这样效率不就大大降低了么？所以这里我们还需要改进一下， 做到不多做一点的无用功。</p>
</blockquote>
<p>3.修改上面的代码加入多层次判断快速创建对象，不多做一点无用功！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="comment">//存放引用的变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">A</span> <span class="variable">ins</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//私有化构造方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">A</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">      ```java</span><br><span class="line">      <span class="comment">//加入同步</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> A <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (ins == <span class="literal">null</span>) &#123;</span><br><span class="line">              <span class="keyword">synchronized</span> (A.class)&#123;</span><br><span class="line">                  <span class="keyword">if</span> (ins == <span class="literal">null</span>)&#123;</span><br><span class="line">                      ins = <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> ins;</span><br><span class="line">      &#125;</span><br><span class="line">｝</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里就不展示效果图了，改进的是运行的速度，这里在首次创建对象的时候会进入锁判断，当创建完成以后，其他的都会直接返回对象，不再进入锁等待着中，大大的提高了运行的效率</p>
</blockquote>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-03-28</span><i class="fa fa-tag"></i><a class="tag" href="/tags/安卓面试经验/" title="安卓面试经验">安卓面试经验 </a><span>About 679 words, 2 min 15 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2017/03/08/2017-03-08-java%E4%B8%AD%E6%9C%89%E5%87%A0%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%B5%81%EF%BC%9F/">java中有几种类型的流？</a></h3></div><div class="post-content"><div class="card"><p><h3 id="1-Java中有几种类型的流？-JDK为每种类型的流提供了一些抽象类类以供继承，请说出它们分别是那些类？"><a href="#1-Java中有几种类型的流？-JDK为每种类型的流提供了一些抽象类类以供继承，请说出它们分别是那些类？" class="headerlink" title="1. Java中有几种类型的流？ JDK为每种类型的流提供了一些抽象类类以供继承，请说出它们分别是那些类？"></a>1. Java中有几种类型的流？ JDK为每种类型的流提供了一些抽象类类以供继承，请说出它们分别是那些类？</h3><blockquote>
<p>IO流用来处理设备之间的数据传输</p>
</blockquote>
<p>流的分类：</p>
<ol>
<li>流按处理数据类型分为两种：字节流与字符流</li>
<li>流按数据流向分:输入流、输出流</li>
</ol>
<p>字符流的抽象基类：</p>
<ol>
<li>Reader用于读取字符流的抽象类</li>
<li>Writer写入字符流的抽象类</li>
</ol>
<p>字节流的抽象基类：</p>
<ol>
<li>InputStream此抽象类是表示字节输入流的所有类的超类。</li>
<li>OutputStream此抽象类是表示输出字节流的所有类的超类</li>
</ol>
<p>结构图：<br><img src="http://img.yuekang.org.cn/2017030801.jpg" alt="结构图"></p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-03-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/java/" title="java">java </a><span>About 183 words, 36 sec  read</span></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/page/4/">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/page/6/">Next</a></li></ul></div></div></div></div></main-outlet><script>(async function(){ if (Anatolo.search == null) await Anatolo.getMsg("search-init"); Anatolo.search.config = {translation:{posts:"Posts",pages:"Pages",categories:"Categories",tags:"Tags",untitled:"(Untitled)",} }; })()</script><div class="searchbox ins-search modal-cover"><div class="searchbox-container ins-search-container modal-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="Anatolo.search.closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div><button class="float-button hide" id="scroll-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" type="button" title="Scroll to top"><i class="fa fa-angle-up"></i></button><div class="modal-cover" id="success-indicator"><div class="modal-container indicator"><i class="fa fa-check"></i></div></div></body></html>