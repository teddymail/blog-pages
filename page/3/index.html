<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Kange"><title>少年当自强</title><meta name="description" content="Write the code. Change the World."><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta id="site_data_static" data-url="/"><meta id="default-theme" data="light"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/theme/light.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&amp;display=swap" rel="stylesheet"><script src="/js_complied/bundle.js"></script><script src="/js/baidu-tongji.js"></script><script>Anatolo.comment.setConfig({"valine":{"enable":true,"appid":"yXrP5LiEu8aLiXNMbcMkjTgk-gzGzoHsz","appkey":"Fb1nRCpsNrMB0U2Fv3jJSCsu","notify":false,"verify":true,"avatar":"","placeholder":"ψ(｀∇´)ψ 快说说你得想法吧！cn.gravatar.com注册专属头像"},"duoshuo":null,"disqus":null,"gentie":null})</script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@latest/dist/Valine.min.js"></script><meta name="generator" content="Hexo 7.3.0"></head><body> <main-outlet><div class="page-top animated"><div class="nav"><li><a href="/">Home</a></li><li><a href="/archives">Archives</a></li><li><a href="/tags">Tags</a></li><li><a href="/about">About</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)" style="display: none"> </a></li><li><a class="fa fa-search" onclick="Anatolo.search.openWindow();"></a></li><li><a class="far fa-sun" onclick="Anatolo.darkLightToggle();"></a></li></div><div class="avatar"><img src="http://img.yuekang.org.cn/me.jpg"></div></div></div><div class="sidebar animated"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:220px;" alt="favicon"><h3 title=""><a href="/">少年当自强</a></h3><div class="description"><p>Write the code. Change the World.</p></div></div><ul class="social-links"><li><a href="https://github.com/teddymail"><i class="fab fa-github"></i></a></li><li><a href="mailto:iyuekang@gmail.com"><i class="fa fa-envelope"></i></a></li><li><a href="https://weibo.com/teddymail"><i class="fab fa-weibo"></i></a></li></ul></div></div><div class="footer"><div class="p"><span>Copyright © Teddy All rights reserved. </span><i class="fa fa-star"></i><span>Kange</span></div><div class="by_farbox"><span>Powered by</span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo</a><span>&</span><a href="https://github.com/Lhcfl/hexo-theme-anatolo" target="_blank">Anatolo</a></div><div class="beian"></div></div></div><div class="main animated fadeInDown"><div class="autopagerize_page_element"><div class="content"><div class="post animated"><div class="post-title"><h3><a href="/2018/07/15/2018-07-15-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95/">负载均衡算法</a></h3></div><div class="post-content"><div class="card"><p><h2 id="本地流量管理技术主要有一下几种负载均衡算法"><a href="#本地流量管理技术主要有一下几种负载均衡算法" class="headerlink" title="本地流量管理技术主要有一下几种负载均衡算法"></a>本地流量管理技术主要有一下几种负载均衡算法</h2><ol>
<li><p>静态负载均衡算法包括：轮询，比率，优先权</p>
<p> 1.1 轮询（Round Robin）：顺序循环将请求一次顺序循环地连接每个服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从顺序循环队列中拿出，不参加下一次的轮询，直到其恢复正常。</p>
<p> 1.2 比率（Ratio）：给每个服务器分配一个加权值为比例，根椐这个比例，把用户的请求分配到每个服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配, 直到其恢复正常。</p>
<p> 1.3 优先权（Priority）：给所有服务器分组,给每个组定义优先权，BIG-IP 用户的请求，分配给优先级最高的服务器组（在同一组内，采用轮询或比率算法，分配用户的请求）；当最高优先级中所有服务器出现故障，BIG-IP 才将请求送给次优先级的服务器组。这种方式，实际为用户提供一种热备份的方式。</p>
</li>
<li><p>动态负载均衡算法包括: 最少连接数,最快响应速度，观察方法，预测法，动态性能分配，动态服务器补充，服务质量，服务类型，规则模式。</p>
<p> 2.1 最少的连接方式（Least Connection）：传递新的连接给那些进行最少连接处理的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配, 直到其恢复正常。</p>
<p> 2.2 最快模式（Fastest）：传递连接给那些响应最快的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。</p>
<p> 2.3 观察模式（Observed）：连接数目和响应时间以这两项的最佳平衡为依据为新的请求选择服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。</p>
<p> 2.4 预测模式（Predictive）：BIG-IP利用收集到的服务器当前的性能指标，进行预测分析，选择一台服务器在下一个时间片内，其性能将达到最佳的服务器相应用户的请求。(被BIG-IP 进行检测)</p>
<p> 2.5 动态性能分配(Dynamic Ratio-APM):BIG-IP 收集到的应用程序和应用服务器的各项性能参数，动态调整流量分配。</p>
<p> 2.6 动态服务器补充(Dynamic Server Act.):当主服务器群中因故障导致数量减少时，动态地将备份服务器补充至主服务器群。</p>
<p> 2.7 服务质量(QoS）:按不同的优先级对数据流进行分配。</p>
<p> 2.8 服务类型(ToS): 按不同的服务类型（在Type of Field中标识）负载均衡对数据流进行分配。</p>
<p> 2.9 规则模式：针对不同的数据流设置导向规则，用户可自行。</p>
</li>
</ol>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-07-15</span><i class="fa fa-tag"></i><a class="tag" href="/tags/负载均衡/" title="负载均衡">负载均衡 </a><span>About 929 words, 3 min 5 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/07/15/2018-07-15-proxy-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE/">proxy 反向代理设置</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>在公司的vpc网络中需要一个统一的对外提供服务的服务器叫proxy 其作用是统一入口，外界无法直接和业务服务器直接通信，而是通过proxy服务器进行服务转发。</p>
</blockquote>
<p>目标是达到如下目的：<br>客户端&#x3D;&gt;（服务器反向代理&#x3D;&gt;）Web服务器</p>
<p><img src="http://img.yuekang.org.cn/2018071201.png" alt="规划图"></p>
<p>线上proxy配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">     listen       443 ssl;</span><br><span class="line">     server_name  abc.ethercap.com;</span><br><span class="line">     ssl on;</span><br><span class="line">     ssl_certificate /etc/pki/CA/certs/ethercap.com.chained.crt;</span><br><span class="line">     ssl_certificate_key /etc/pki/CA/certs/ethercap.com.key;</span><br><span class="line">     keepalive_timeout    60;</span><br><span class="line"></span><br><span class="line">     location / &#123;</span><br><span class="line">         proxy_pass          http://base_server;</span><br><span class="line"></span><br><span class="line">         proxy_http_version 1.1;</span><br><span class="line">         proxy_set_header Host $host;</span><br><span class="line">         proxy_set_header Connection &quot;&quot;;</span><br><span class="line">         proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">         proxy_set_header X-Forwarded-Proto https;</span><br><span class="line"></span><br><span class="line">         proxy_redirect      off;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>关键点是 proxy_pass</p>
<p>proxy_pass 可以做的几件事是这样的:</p>
<p>本地不处理，交给后面处理<br>这样后面就可以用php, fastcgi, tomcat等处理<br>可以切换协议，比如从http切换至https<br>实际上在linux上还可以将底层切换至unix domain socket</p>
<p>&#x2F;&#x2F; 这些设置主要是给业务服务器做认证的<br>proxy_http_version 1.1;</p>
<p>&#x2F;&#x2F;这个proxy_set_header Host $host;  $host就是nginx代理服务器，也就是客户端请求的host<br>proxy_set_header Host $host;</p>
<p>&#x2F;&#x2F;任何逐段传输头都需要在 Connection 头中列出，这样才能让第一个代理知道必须处理它们且不转发这些头<br>proxy_set_header Connection “”;</p>
<p>&#x2F;&#x2F;X-Forwarded-For 表示 Nginx 接收到的头，原样的转发过来（假如不转发，Web 服务器就不能获取这个头）<br>proxy_set_header X-Forwarded-For $remote_addr;</p>
<p>&#x2F;&#x2F;转发的协议<br>proxy_set_header X-Forwarded-Proto https;</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-07-15</span><i class="fa fa-tag"></i><a class="tag" href="/tags/nginx/" title="nginx">nginx </a><i class="fa fa-tag"></i><a class="tag" href="/tags/反向代理/" title="反向代理">反向代理 </a><span>About 431 words, 1 min 26 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/07/08/2018-07-08-CentOS7-%E5%AE%89%E8%A3%85OpenLdap/">CentOS7 安装OpenLdap</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>正常在企业的环境中，会遇到账户统一管理的事情，当手下就不几台服务器时在每个机器上都创建一遍好像也没多大事事情，但当人经常更换，或者服务器达到上百台的时候这个账号的管理将会是噩梦，今天就来一起安装OpenLdap来达到网络统一账号管理和验证的目的。</p>
</blockquote>
<h1 id="什么是LDAP"><a href="#什么是LDAP" class="headerlink" title="什么是LDAP?"></a>什么是LDAP?</h1><p>LDAP 全称轻量级目录访问协议（英文：Lightweight Directory Access Protocol），是一个运行在 TCP&#x2F;IP 上的目录访问协议。目录是一个特殊的数据库，它的数据经常被查询，但是不经常更新。其专门针对读取、浏览和搜索操作进行了特定的优化。目录一般用来包含描述性的，基于属性的信息并支持精细复杂的过滤能力。比如 DNS 协议便是一种最被广泛使用的目录服务。</p>
<p>LDAP 中的信息按照目录信息树结构组织，树中的一个节点称之为条目（Entry），条目包含了该节点的属性及属性值。条目都可以通过识别名 dn 来全局的唯一确定1，可以类比于关系型数据库中的主键。比如 dn 为 uid&#x3D;teddy,ou&#x3D;People,dc&#x3D;ethercap,dc&#x3D;com 的条目表示在组织中一个名字叫做 teddy 的员工，其中 uid&#x3D;teddy 也被称作相对区别名 rdn。</p>
<table>
<thead>
<tr>
<th align="left">属性名</th>
<th align="left">是否必填</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">cn</td>
<td align="left">是</td>
<td align="left">该条目被人所熟知的通用名（Common Name）</td>
</tr>
<tr>
<td align="left">sn</td>
<td align="left">是</td>
<td align="left">该条目的姓氏</td>
</tr>
<tr>
<td align="left">o</td>
<td align="left">否</td>
<td align="left">该条目所属的组织名（Organization Name）</td>
</tr>
<tr>
<td align="left">mobile</td>
<td align="left">否</td>
<td align="left">该条目的手机号码</td>
</tr>
<tr>
<td align="left">description</td>
<td align="left">否</td>
<td align="left">该条目的描述信息</td>
</tr>
</tbody></table>
<p>下面是一个典型的 LDAP 目录树结构，其中每个节点表示一个条目。接下来将按照这个结构来配置一个 LDAP 服务。</p>
<p><img src="http://img.yuekang.org.cn/2018070902.png"></p>
<p>LDAP server搭建</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//安装软件</span></span><br><span class="line">yum -y install openldap openldap-servers openldap-clients</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置/etc/openldap/slapd.conf</span></span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/core.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/cosine.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/duaconf.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/dyngroup.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/inetorgperson.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/java.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/misc.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/nis.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/openldap.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/ppolicy.schema</span><br><span class="line"><span class="keyword">include</span> /etc/openldap/schema/collective.schema</span><br><span class="line">pidfile /<span class="keyword">var</span>/run/openldap/slapd.pid</span><br><span class="line">argsfile /<span class="keyword">var</span>/run/openldap/slapd.args</span><br><span class="line">database bdb</span><br><span class="line">suffix <span class="string">&quot;dc=hostname,dc=com&quot;</span></span><br><span class="line">rootdn <span class="string">&quot;cn=ffff,dc=hostname,dc=com&quot;</span></span><br><span class="line">rootpw esdfdsf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//数据会存放到/var/openldap-data/ 中</span></span><br><span class="line"><span class="comment">//id2entry.bdb 一开始会没有，使用JXplorer即可自动生成这个文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 记得/var/openldap-data/DB_CONFIG</span></span><br><span class="line">cp /usr/share/openldap-servers/DB_CONFIG.example /<span class="keyword">var</span>/openldap-data/DB_CONFIG</span><br><span class="line"></span><br><span class="line"><span class="comment">//加入到service管理体系中</span></span><br><span class="line">systemctl enable slapd</span><br><span class="line">systemctl start slapd</span><br><span class="line"></span><br><span class="line"><span class="comment">//导入用户组</span></span><br><span class="line">dn: dc=ethercap,dc=com</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectclass: organization</span><br><span class="line">o: Server World</span><br><span class="line">dc: ethercap</span><br><span class="line"></span><br><span class="line">dn: ou=people,dc=ethercap,dc=com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: people</span><br><span class="line"></span><br><span class="line">dn: ou=groups,dc=ethercap,dc=com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: groups</span><br><span class="line"></span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:<span class="comment">/// -f front.ldif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加用户</span></span><br><span class="line">cat /etc/passwd | grep yk &gt; /tmp/passwd.in</span><br><span class="line">/usr/share/migrationtools/migrate_passwd.pl /tmp/passwd.in &gt; /tmp/passwd.ldif</span><br><span class="line"></span><br><span class="line"><span class="comment">//发现dc不对，可以通过 修改</span></span><br><span class="line">vi /usr/share/migrationtools/migrate_common.ph</span><br><span class="line"><span class="variable">$DEFAULT_BASE</span> = <span class="string">&quot;dc=ethercap,dc=com&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看生成文件，没什么毛病</span></span><br><span class="line">dn: uid=yk,ou=People,dc=ethercap,dc=com</span><br><span class="line">uid: yk</span><br><span class="line">cn: yk</span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword: &#123;crypt&#125;$<span class="number">1</span>$eZc1Mzdw<span class="variable">$HBvCDOC1KEWIO699dLCNl1</span></span><br><span class="line">shadowLastChange: <span class="number">17722</span></span><br><span class="line">shadowMin: <span class="number">0</span></span><br><span class="line">shadowMax: <span class="number">99999</span></span><br><span class="line">shadowWarning: <span class="number">7</span></span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: <span class="number">1001</span></span><br><span class="line">gidNumber: <span class="number">1001</span></span><br><span class="line">homeDirectory: /home/yk</span><br><span class="line"></span><br><span class="line"><span class="comment">//导入用户到ldap</span></span><br><span class="line">ldapadd -x -D <span class="string">&quot;cn=admin,dc=ethercap,dc=com&quot;</span> -W -f /tmp/passwd.ldif</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>导入后的效果<br><img src="http://img.yuekang.org.cn/2018071001.png"></p>
<h1 id="LdapClient-客户端配置"><a href="#LdapClient-客户端配置" class="headerlink" title="LdapClient 客户端配置"></a>LdapClient 客户端配置</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">//安装客户端必备软件</span><br><span class="line">yum install -y oddjob-mkhomedir oddjob openssh-ldap</span><br><span class="line"></span><br><span class="line">//开启相关配置选项 /etc/sysconfig/authconfig</span><br><span class="line">USELDAP=yes  </span><br><span class="line">USELDAPAUTH=yes  </span><br><span class="line">USEMD5=no  </span><br><span class="line">USESHADOW=yes  </span><br><span class="line">USELOCAUTHORIZE=yes</span><br><span class="line"></span><br><span class="line">//配置ldap /etc/openldap/ldap.conf</span><br><span class="line">URI ldap://URL/</span><br><span class="line">BASE dc=ethercap,dc=com</span><br><span class="line">BINDDN cn=admins</span><br><span class="line"></span><br><span class="line">//配置centos验证方式/etc/nsswitch.conf文件,修改为ldap验证</span><br><span class="line">passwd:     files ldap</span><br><span class="line">shadow:     files ldap</span><br><span class="line">group:      files ldap</span><br><span class="line"></span><br><span class="line">//加入到service管理</span><br><span class="line">chkconfig oddjobd on</span><br><span class="line"></span><br><span class="line">//启动服务</span><br><span class="line">service messagebus start</span><br><span class="line">service oddjobd start</span><br><span class="line"></span><br><span class="line">//启用自动创建目录</span><br><span class="line">authconfig --enablemkhomedir --update</span><br><span class="line"></span><br><span class="line">//修改ssdh加入命令 两条都得有缺一不可！</span><br><span class="line">AuthorizedKeysCommand /usr/libexec/openssh/ssh-ldap-wrapper</span><br><span class="line">AuthorizedKeysCommandUser root</span><br><span class="line"></span><br><span class="line">//手动添加/etc/pam.d/password-auth和system-auth</span><br><span class="line">session     optional      pam_oddjob_mkhomedir.so umask=0077</span><br><span class="line"></span><br><span class="line">//重启服务 生效配置</span><br><span class="line">service nslcd restart</span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure>

<p>采坑总结，自动家目录创建依靠pam_oddjob_mkhomedir.so来实现，前期,使用之前确保oddjobd 是运行状态,否则报错！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yk@dev:~$ service oddjobd status</span><br><span class="line">Redirecting to /bin/systemctl status  oddjobd.service</span><br><span class="line">● oddjobd.service - privileged operations for unprivileged applications</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/oddjobd.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 三 2018-07-11 17:37:39 CST; 4h 59min ago</span><br><span class="line"> Main PID: 15108 (oddjobd)</span><br><span class="line">   CGroup: /system.slice/oddjobd.service</span><br><span class="line">           └─15108 /usr/sbin/oddjobd -n -p /var/run/oddjobd.pid -t 300</span><br></pre></td></tr></table></figure>


<p>修改sshd_config重启后报错，单纯查看状态无法知道错误信息，可以通过下面的命令查看</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">`which sshd` -D -d</span><br></pre></td></tr></table></figure></p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-07-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/LDAP/" title="LDAP">LDAP </a><i class="fa fa-tag"></i><a class="tag" href="/tags/CentOS/" title="CentOS">CentOS </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Linux/" title="Linux">Linux </a><span>About 1173 words, 3 min 54 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/07/05/2018-07-05-CGI%E4%B8%8EFastCGI-%E5%AD%A6%E4%B9%A0/">CGI与FastCGI 学习</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>CGI:是 Web Server 与 Web Application 之间数据交换的一种协议。<br>FastCGI:同 CGI，是一种通信协议，但比 CGI 在效率上做了一些优化。<br>PHP-CGI:是 PHP （Web Application）对 Web Server 提供的 CGI 协议的接口程序。<br>PHP-FPM:是 PHP（Web Application）对 Web Server 提供的 FastCGI 协议的接口程序，额外还提供了相对智能一些任务管理</p>
</blockquote>
<h1 id="CGI工作流程"><a href="#CGI工作流程" class="headerlink" title="CGI工作流程"></a>CGI工作流程</h1><ol>
<li><p>如果客户端请求的是 index.html，那么Web Server会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。</p>
</li>
<li><p>当Web Server收到 index.php 这个请求后，会启动对应的 CGI 程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定CGI规定的格式返回处理后的结果，退出进程，Web server再把结果返回给浏览器。</p>
</li>
</ol>
<h1 id="FastCGI工作流程"><a href="#FastCGI工作流程" class="headerlink" title="FastCGI工作流程"></a>FastCGI工作流程</h1><p>1.如果客户端请求的是 index.html，那么Web Server会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。</p>
<p>2.当Web Server收到 index.php 这个请求后,FastCGI程序(FastCGI在启动时就初始化执行执行环境，每个CGI进程池各个CGI进程共享执行环境)在CGI进程池中选择一个CGI进程处理请求，再以规定CGI规定的格式返回处理后的结果，继续等待下一个请求。</p>
<h1 id="PHP-FPM基本实现"><a href="#PHP-FPM基本实现" class="headerlink" title="PHP-FPM基本实现"></a>PHP-FPM基本实现</h1><p>1.PHP-FPM的实现就是创建一个master进程，在master进程中创建worker pool并让其监听socket，然后fork出多个子进程(work)，这些子进程各自accept请求，子进程的处理非常简单，它在启动后阻塞在accept上，有请求到达后开始读取请求数据，读取完成后开始处理然后再返回，在这期间是不会接收其它请求的，也就是说PHP-FPM的子进程同时只能响应一个请求，只有把这个请求处理完成后才会accept下一个请求</p>
<p>2.PHP-FPM的master进程与worker进程之间不会直接进行通信，master通过共享内存获取worker进程的信息，比如worker进程当前状态、已处理请求数等，当master进程要杀掉一个worker进程时则通过发送信号的方式通知worker进程。</p>
<p>3.PHP-FPM可以同时监听多个端口，每个端口对应一个worker pool，而每个pool下对应多个worker进程</p>
<p><img src="http://img.yuekang.org.cn/2018070501.png"></p>
<h2 id="Worker工作流程"><a href="#Worker工作流程" class="headerlink" title="Worker工作流程"></a>Worker工作流程</h2><p>1.等待请求： worker进程阻塞在fcgi_accept_request()等待请求；<br>2.解析请求： fastcgi请求到达后被worker接收，然后开始接收并解析请求数据，直到request数据完全到达；<br>3.请求初始化： 执行php_request_startup()，此阶段会调用每个扩展的：PHP_RINIT_FUNCTION()；<br>4.编译、执行： 由php_execute_script()完成PHP脚本的编译、执行；<br>5.关闭请求： 请求完成后执行php_request_shutdown()，此阶段会调用每个扩展的：PHP_RSHUTDOWN_FUNCTION()，然后进入步骤(1)等待下一个请求。</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-07-05</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP/" title="PHP">PHP </a><i class="fa fa-tag"></i><a class="tag" href="/tags/CGI/" title="CGI">CGI </a><i class="fa fa-tag"></i><a class="tag" href="/tags/FastCGI/" title="FastCGI">FastCGI </a><span>About 855 words, 2 min 51 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/07/04/2018-07-04-find-locate%E6%9F%A5%E6%89%BE%E6%96%87%E4%BB%B6/">find,locate查找文件</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>在使用linux时经常会不知道自己想要的文件在哪里存放着，可能会知道一个大致的位置但是却不知道精确目录和位置，这个时候搜索变得异常的方便，今天就来学学搜索命令。</p>
</blockquote>
<h1 id="find-搜索命令"><a href="#find-搜索命令" class="headerlink" title="find 搜索命令"></a>find 搜索命令</h1><blockquote>
<p>这个命令是真实的遍历模式，会逐层搜索需要匹配的目标，直到搜索完毕。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//列出当前目录文件以及子目录的所有文件</span><br><span class="line">[yuekang@ykdev test]$ find .</span><br><span class="line">.</span><br><span class="line">./abnc.txt</span><br><span class="line"></span><br><span class="line">//指定文件搜索</span><br><span class="line">[yuekang@ykdev test]$ find -name &quot;ab*&quot;</span><br><span class="line">./abnc.txt</span><br><span class="line"></span><br><span class="line">//忽略大小写搜索</span><br><span class="line">[yuekang@ykdev test]$ find -iname &quot;AB*&quot;</span><br><span class="line">./abnc.txt</span><br><span class="line"></span><br><span class="line">//搜索多个文件</span><br><span class="line">[yuekang@ykdev test]$ find . -name &quot;*.txt&quot; -o -name &quot;*.pdf&quot;</span><br><span class="line">./abnc.txt</span><br><span class="line">./ab.pdf</span><br><span class="line"></span><br><span class="line">//匹配文件路径或文件,实际上还是匹配文件</span><br><span class="line">[yuekang@ykdev test]$ find . -path &quot;*yuekang*&quot;</span><br><span class="line">[yuekang@ykdev test]$ find . -path &quot;*ab*&quot;</span><br><span class="line">./abnc.txt</span><br><span class="line">./ab.pdf</span><br><span class="line">[yuekang@ykdev ~]$ find /home/ -path &quot;*yuekang*&quot;</span><br><span class="line">find: ‘/home/jira’: 权限不够</span><br><span class="line">/home/yuekang</span><br><span class="line"></span><br><span class="line">//正则匹配文件</span><br><span class="line">[yuekang@ykdev test]$ find . -regex &quot;.*\(\.txt\|\.pdf\)$&quot;</span><br><span class="line">./abnc.txt</span><br><span class="line">./ab.pdf</span><br><span class="line"></span><br><span class="line">//否定查找</span><br><span class="line">[yuekang@ykdev test]$ find . ! -name &quot;*.pdf&quot;</span><br><span class="line">.</span><br><span class="line">./abnc.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="locate-搜索命令"><a href="#locate-搜索命令" class="headerlink" title="locate 搜索命令"></a>locate 搜索命令</h1><blockquote>
<p>这个命令不搜索具体目录，而是搜索一个数据库记录（&#x2F;var&#x2F;lib&#x2F;mlocate&#x2F;mlocate.db），更新频率为每天更新，所以可能会搜索到已经删除或者搜索不到刚创建的文件，<code>updatedb</code> 可以完成重新刷新文件信息。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//查找文件，当新建文件查询不到时需要手动updatedb更新本地文件数据库</span><br><span class="line">╭─root@ykdev /home/yuekang/test</span><br><span class="line">╰─# locate abnc.txt</span><br><span class="line">╭─root@ykdev /home/yuekang/test</span><br><span class="line">╰─# updatedb</span><br><span class="line">╭─root@ykdev /home/yuekang/test</span><br><span class="line">╰─# locate abnc.txt</span><br><span class="line">/home/yuekang/test/abnc.txt</span><br><span class="line"></span><br><span class="line">//通过regex 正则匹配文件</span><br><span class="line"></span><br><span class="line">root@ykdev /home/yuekang/test</span><br><span class="line">╰─# locate -r &quot;.*\(\.pdf\)&quot;</span><br><span class="line">/home/yuekang/test/ab.pdf</span><br><span class="line">/usr/share/doc/aic94xx-firmware-30/README-94xx.pdf</span><br><span class="line">/usr/share/doc/bzip2-devel-1.0.6/manual.pdf</span><br><span class="line">/usr/share/doc/libtasn1-4.10/libtasn1.pdf</span><br><span class="line">/usr/share/doc/libxml2-devel-2.9.1/tutorial/xmltutorial.pdf</span><br></pre></td></tr></table></figure></p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-07-04</span><i class="fa fa-tag"></i><a class="tag" href="/tags/linux/" title="linux">linux </a><i class="fa fa-tag"></i><a class="tag" href="/tags/shell/" title="shell">shell </a><span>About 501 words, 1 min 40 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/06/27/2018-06-27-Yii-mail%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0/">Yii-mail模块学习</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>邮件已经是办公必备了，在Yii中已经封装了一套完整邮件代码，帮助我们快速的建立系统邮件的邮件发送功能，其易于扩展的设计结构功能开发变得简化。</p>
</blockquote>
<h1 id="邮件发送格式"><a href="#邮件发送格式" class="headerlink" title="邮件发送格式"></a>邮件发送格式</h1><p><img src="http://img.yuekang.org.cn/2018062701.png" alt="邮件发送格式"></p>
<p>一个正常的邮件具有：发件人、收件人、回复地址、抄送地址、主题、正文</p>
<h1 id="Yii中mail模块是怎么设计的？"><a href="#Yii中mail模块是怎么设计的？" class="headerlink" title="Yii中mail模块是怎么设计的？"></a>Yii中mail模块是怎么设计的？</h1><p><img src="http://img.yuekang.org.cn/2018062702.png" alt="yii mail模块"></p>
<p>分三块，分别是管理邮件发送相关的，邮件格式相关的，邮件事件相关</p>
<p>1.1 MessageInterface</p>
<p>定义了邮件相关格式相关</p>
<p>1.2 MailerInterface<br>定义邮件应该具有相关功能</p>
<p>1.3 BaseMessage<br>实现了个邮件send和toString作为初始化的补充</p>
<p>1.4 BaseMailer<br>它就厉害了，是个头，兼顾邮件发送格式内容的处理，事件发送，邮件动作等功能</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-06-27</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP/" title="PHP">PHP </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Yii/" title="Yii">Yii </a><i class="fa fa-tag"></i><a class="tag" href="/tags/Mail/" title="Mail">Mail </a><span>About 230 words, 46 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/06/24/2018-06-24-yar%E5%AD%A6%E4%B9%A0/">yar学习</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>Yar(yet another RPC framework), RPC框架, 和现有的RPC框架(xml-rpc, soap)不同, 这是一个轻量级的框架, 支持多种打包协议(msgpack, json, php), 并且最重要的一个特点是, 它是可并行化的…</p>
</blockquote>
<h1 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h1><ol>
<li>快速，简单，简单</li>
<li>并发RPC调用</li>
<li>支持多个数据包装器（内置php，json，msgpack）</li>
<li>支持多种传输协议（http实现，稍后将支持tcp &#x2F; unix）</li>
<li>详细的调试信息</li>
</ol>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>作者要求至少满足以下条件</p>
<ol>
<li>PHP 5.2+</li>
<li>Curl</li>
<li>Json</li>
<li>Msgpack (Optional)： 新型二进制打包协议比json和xml快很多，和序列化的效率差不多</li>
</ol>
<h1 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h1><ol>
<li>安装yar</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pecl install yar</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装msgpack</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">pecl install msgpack</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>运行时配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yar.timeout //默认5000（ms）</span><br><span class="line">yar.connect_timeout //默认值1000（ms）</span><br><span class="line">yar.packager //默认“php”，当使用--enable-msgpack然后默认“msgpack”构建时，它应该是“php”，“json”，“msgpack”</span><br><span class="line">yar.debug //默认关闭</span><br><span class="line">yar.expose_info //默认为On，是否输出GET请求的API信息</span><br><span class="line">yar.content_type //默认的“application / octet-stream”</span><br><span class="line">yar.allow_persistent //默认关闭</span><br></pre></td></tr></table></figure>
<h1 id="编写第一个server"><a href="#编写第一个server" class="headerlink" title="编写第一个server"></a>编写第一个server</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试Name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span>= <span class="string">&#x27;foo&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getB</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$service</span> = <span class="keyword">new</span> <span class="title class_">Yar_Server</span>(<span class="keyword">new</span> <span class="title class_">Api</span>());</span><br><span class="line"><span class="variable">$service</span>-&gt;<span class="title function_ invoke__">handle</span>();</span><br></pre></td></tr></table></figure>

<p>直接访问网页可以看到对应的内容已经展现出来了</p>
<p><img src="http://img.yuekang.org.cn/2018062401.png" alt="运行效果"></p>
<h1 id="编写第一个客户端请求rpc接口"><a href="#编写第一个客户端请求rpc接口" class="headerlink" title="编写第一个客户端请求rpc接口"></a>编写第一个客户端请求rpc接口</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">Yar_Client</span>(<span class="string">&quot;https://admin.myhost.top/Api/&quot;</span>);</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">getName</span>(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;my value&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>请求后可以获得如下结果</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;my value&quot;</span></span><br></pre></td></tr></table></figure>

<p>至此一个简单的rpc功能完成了，后续会学习更深层的使用方式</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-06-24</span><i class="fa fa-tag"></i><a class="tag" href="/tags/php/" title="php">php </a><i class="fa fa-tag"></i><a class="tag" href="/tags/framework/" title="framework">framework </a><i class="fa fa-tag"></i><a class="tag" href="/tags/RPC/" title="RPC">RPC </a><span>About 433 words, 1 min 26 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/06/21/2018-06-21-PHP7-IO%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0/">PHP7- I/O模型学习</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>四种响应模型</p>
<ol>
<li>同步：调用后，死等，等到结果为止</li>
<li>异步：调用立即返回，等到有结果通知</li>
<li>阻塞：数据没有处理完成前不返回</li>
<li>非阻塞：调用立即返回等到有结果通知我</li>
</ol>
</blockquote>
<h1 id="五种I-O模型"><a href="#五种I-O模型" class="headerlink" title="五种I&#x2F;O模型"></a>五种I&#x2F;O模型</h1><ol>
<li>阻塞I&#x2F;O (Blocking I&#x2F;O)</li>
</ol>
<p><img src="http://img.yuekang.org.cn/2018062101.png" alt="阻塞I/O"></p>
<p>当进程进行系统调用时，内核开始了IO的第一个阶段准备数据，准备完成交给内核缓冲最后拷贝到用户进程的内存中，然后才解锁进程，这个等待过程称为阻塞。</p>
<ol start="2">
<li>非阻塞I&#x2F;O (Non-Blocking I&#x2F;O)</li>
</ol>
<p><img src="http://img.yuekang.org.cn/2018062102.png" alt="非阻塞I/O"></p>
<p>进程在第二阶段被阻塞，调用的时候没有阻塞，第二阶段开始不断轮训CPU询问数据是否准备完毕，所以比较消耗CPU资源的模型</p>
<ol start="3">
<li>I&#x2F;O复用（I&#x2F;O Multiplexing)</li>
</ol>
<p><img src="http://img.yuekang.org.cn/2018062103.png" alt="I/O复用"></p>
<p>IO执行的两个阶段进程都是阻塞的，在这次完整的过程中，进程发起了两次系统调用。和阻塞IO不同的是第一阶段可以等待多个调用结果</p>
<ol start="4">
<li>信号驱动的I&#x2F;O (Signal Driven I&#x2F;O)</li>
</ol>
<p><img src="http://img.yuekang.org.cn/2018062104.png" alt="信号驱动的I/O"></p>
<p>只有在IO执行的第二阶段阻塞了进程，该模型在IO执行的第一阶段，当数据完成之后，会主动通知进程数据已经准备好，对进程做一个回调，通知分为两种，一位水平触发，及时进程不响应会一直发送通知，二为边缘触发，即只通知一次</p>
<ol start="5">
<li>异步I&#x2F;O (Asynchrnous I&#x2F;O)</li>
</ol>
<p><img src="http://img.yuekang.org.cn/2018062105.png" alt="异步I/O"></p>
<p>当进程发起系统调用后，立刻就可以开始做其它事情，然后知道IO执行的两个阶段都完成之后，内核会给集成发送通知，告之进程已经完成处理了。</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-06-21</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP7/" title="PHP7">PHP7 </a><i class="fa fa-tag"></i><a class="tag" href="/tags/IO/" title="IO">IO </a><span>About 497 words, 1 min 39 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/06/19/2018-06-19-array%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E6%95%B4%E7%90%86/">array常用函数整理</a></h3></div><div class="post-content"><div class="card"><p><h1 id="array-chunk"><a href="#array-chunk" class="headerlink" title="array_chunk"></a><a href="http://php.net/manual/zh/function.array-chunk.php">array_chunk</a></h1><blockquote>
<p>array_chunk — 将一个数组分割成多个</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_chunk</span>(<span class="variable">$arr</span>, <span class="number">2</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_chunk</span>(<span class="variable">$arr</span>, <span class="number">2</span>, <span class="literal">false</span>));</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    <span class="keyword">string</span>(<span class="number">1</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="array-column"><a href="#array-column" class="headerlink" title="array_column"></a><a href="http://php.net/manual/zh/function.array-column.php">array_column</a></h1><blockquote>
<p>array_column — 返回数组中指定的一列</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = [</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">123</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;name1&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">124</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;name2&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">125</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;name3&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    [</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">126</span>,</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;name4&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_column</span>(<span class="variable">$arr</span>, <span class="string">&#x27;name&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_column</span>(<span class="variable">$arr</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;id&#x27;</span>));</span><br><span class="line"></span><br><span class="line">结果:</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name1&quot;</span></span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name2&quot;</span></span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name3&quot;</span></span><br><span class="line">  [<span class="number">3</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name4&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  [<span class="number">123</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name1&quot;</span></span><br><span class="line">  [<span class="number">124</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name2&quot;</span></span><br><span class="line">  [<span class="number">125</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name3&quot;</span></span><br><span class="line">  [<span class="number">126</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;name4&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="array-combine"><a href="#array-combine" class="headerlink" title="array_combine"></a><a href="http://php.net/manual/zh/function.array-combine.php">array_combine</a></h1><blockquote>
<p>array_combine — 创建一个数组，用一个数组的值作为其键名，另一个数组的值作为其值</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$key</span> = [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>];</span><br><span class="line"><span class="variable">$value</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_combine</span>(<span class="variable">$key</span>,<span class="variable">$value</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;one&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  [<span class="string">&quot;two&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">  [<span class="string">&quot;three&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="array-count-values"><a href="#array-count-values" class="headerlink" title="array_count_values"></a><a href="http://php.net/manual/zh/function.array-count-values.php">array_count_values</a></h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$array</span> = <span class="keyword">array</span>(<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>, <span class="number">1</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_count_values</span>(<span class="variable">$array</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">  [<span class="string">&quot;hello&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">  [<span class="string">&quot;world&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="array-diff"><a href="#array-diff" class="headerlink" title="array_diff"></a><a href="http://php.net/manual/zh/function.array-diff.php">array_diff</a></h1><blockquote>
<p>array_diff — 计算数组的差集</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$array1</span> = <span class="keyword">array</span>(<span class="string">&quot;a&quot;</span> =&gt; <span class="string">&quot;green&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="variable">$array2</span> = <span class="keyword">array</span>(<span class="string">&quot;b&quot;</span> =&gt; <span class="string">&quot;green&quot;</span>, <span class="string">&quot;yellow&quot;</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">array_diff</span>(<span class="variable">$array1</span>, <span class="variable">$array2</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;blue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="array-fill"><a href="#array-fill" class="headerlink" title="array_fill"></a><a href="http://php.net/manual/zh/function.array-fill.php">array_fill</a></h1><blockquote>
<p>array_fill — 用给定的值填充数组</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">array_fill</span>(<span class="number">5</span>, <span class="number">6</span>, <span class="string">&#x27;banana&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">array_fill</span>(-<span class="number">2</span>, <span class="number">4</span>, <span class="string">&#x27;pear&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$b</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [<span class="number">5</span>] =&gt; banana</span><br><span class="line">    [<span class="number">6</span>] =&gt; banana</span><br><span class="line">    [<span class="number">7</span>] =&gt; banana</span><br><span class="line">    [<span class="number">8</span>] =&gt; banana</span><br><span class="line">    [<span class="number">9</span>] =&gt; banana</span><br><span class="line">    [<span class="number">10</span>] =&gt; banana</span><br><span class="line">)</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [-<span class="number">2</span>] =&gt; pear</span><br><span class="line">    [<span class="number">0</span>] =&gt; pear</span><br><span class="line">    [<span class="number">1</span>] =&gt; pear</span><br><span class="line">    [<span class="number">2</span>] =&gt; pear</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter"></a><a href="http://php.net/manual/en/function.array-filter.php">array_filter</a></h1><blockquote>
<p>array_filter — 用回调函数过滤数组中的单元</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">array_filter</span>(<span class="variable">$arr</span>, function (<span class="variable">$val</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$val</span> % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$res</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">5</span>) &#123;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">  [<span class="number">3</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">4</span>)</span><br><span class="line">  [<span class="number">4</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">6</span>)</span><br><span class="line">  [<span class="number">6</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">8</span>)</span><br><span class="line">  [<span class="number">8</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">10</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="array-flip"><a href="#array-flip" class="headerlink" title="array_flip"></a><a href="http://php.net/manual/zh/function.array-flip.php">array_flip</a></h1><blockquote>
<p>array_flip — 交换数组中的键和值</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$input</span> = <span class="keyword">array</span>(<span class="string">&quot;oranges&quot;</span>, <span class="string">&quot;apples&quot;</span>, <span class="string">&quot;pears&quot;</span>);</span><br><span class="line"><span class="variable">$flipped</span> = <span class="title function_ invoke__">array_flip</span>(<span class="variable">$input</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$flipped</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;oranges&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">0</span>)</span><br><span class="line">  [<span class="string">&quot;apples&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  [<span class="string">&quot;pears&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="array-keys"><a href="#array-keys" class="headerlink" title="array_keys"></a><a href="http://php.net/manual/zh/function.array-keys.php">array_keys</a></h1><blockquote>
<p>array_keys — 返回数组中部分的或所有的键名</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$input</span> = <span class="keyword">array</span>(<span class="string">&quot;oranges&quot;</span>, <span class="string">&quot;apples&quot;</span>, <span class="string">&quot;pears&quot;</span>);</span><br><span class="line"><span class="variable">$flipped</span> = <span class="title function_ invoke__">array_keys</span>(<span class="variable">$input</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$flipped</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">0</span>)</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="array-map"><a href="#array-map" class="headerlink" title="array_map"></a><a href="http://php.net/manual/zh/function.array-map.php">array_map</a></h1><blockquote>
<p>array_map — 为数组的每个元素应用回调函数</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$input</span> = <span class="keyword">array</span>(<span class="string">&quot;oranges&quot;</span>, <span class="string">&quot;apples&quot;</span>, <span class="string">&quot;pears&quot;</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">array_map</span>(function (<span class="variable">$val</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$val</span> . <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">&#125;, <span class="variable">$input</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$res</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;oranges123&quot;</span></span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;apples123&quot;</span></span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">8</span>) <span class="string">&quot;pears123&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="array-rand"><a href="#array-rand" class="headerlink" title="array_rand"></a><a href="http://php.net/manual/zh/function.array-rand.php">array_rand</a></h1><blockquote>
<p>array_rand — 从数组中随机取出一个或多个单元</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$input</span> = <span class="keyword">array</span>(<span class="string">&quot;oranges&quot;</span>, <span class="string">&quot;apples&quot;</span>, <span class="string">&quot;pears&quot;</span>);</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">array_rand</span>(<span class="variable">$input</span>, <span class="number">2</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$res</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$input</span>[<span class="variable">$res</span>[<span class="number">1</span>]]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;pears&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="array-replace"><a href="#array-replace" class="headerlink" title="array_replace"></a><a href="http://php.net/manual/zh/function.array-replace.php">array_replace</a></h1><blockquote>
<p>array_replace — 使用传递的数组替换第一个数组的元素</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$base</span> = <span class="keyword">array</span>(<span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;raspberry&quot;</span>);</span><br><span class="line"><span class="variable">$replacements</span> = <span class="keyword">array</span>(<span class="number">0</span> =&gt; <span class="string">&quot;pineapple&quot;</span>, <span class="number">4</span> =&gt; <span class="string">&quot;cherry&quot;</span>);</span><br><span class="line"><span class="variable">$replacements2</span> = <span class="keyword">array</span>(<span class="number">0</span> =&gt; <span class="string">&quot;grape&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$basket</span> = <span class="title function_ invoke__">array_replace</span>(<span class="variable">$base</span>, <span class="variable">$replacements</span>, <span class="variable">$replacements2</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$basket</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; grape</span><br><span class="line">    [<span class="number">1</span>] =&gt; banana</span><br><span class="line">    [<span class="number">2</span>] =&gt; apple</span><br><span class="line">    [<span class="number">3</span>] =&gt; raspberry</span><br><span class="line">    [<span class="number">4</span>] =&gt; cherry</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="array-slice"><a href="#array-slice" class="headerlink" title="array_slice"></a><a href="http://php.net/manual/zh/function.array-slice.php">array_slice</a></h1><blockquote>
<p>array_slice — 从数组中取出一段</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$base</span> = <span class="keyword">array</span>(<span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;raspberry&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_slice</span>(<span class="variable">$base</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;orange&quot;</span></span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;banana&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="arsort"><a href="#arsort" class="headerlink" title="arsort"></a><a href="http://php.net/manual/zh/function.arsort.php">arsort</a></h1><blockquote>
<p>arsort — 对数组进行逆向排序并保持索引关系</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$fruits</span> = <span class="keyword">array</span>(<span class="string">&quot;d&quot;</span> =&gt; <span class="string">&quot;aemon&quot;</span>, <span class="string">&quot;a&quot;</span> =&gt; <span class="string">&quot;brange&quot;</span>, <span class="string">&quot;b&quot;</span> =&gt; <span class="string">&quot;canana&quot;</span>, <span class="string">&quot;c&quot;</span> =&gt; <span class="string">&quot;dpple&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">arsort</span>(<span class="variable">$fruits</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$fruits</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;c&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;dpple&quot;</span></span><br><span class="line">  [<span class="string">&quot;b&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;canana&quot;</span></span><br><span class="line">  [<span class="string">&quot;a&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;brange&quot;</span></span><br><span class="line">  [<span class="string">&quot;d&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aemon&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="asort"><a href="#asort" class="headerlink" title="asort"></a><a href="http://php.net/manual/zh/function.asort.php">asort</a></h1><blockquote>
<p>asort — 对数组进行排序并保持索引关系</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$fruits</span> = <span class="keyword">array</span>(<span class="string">&quot;d&quot;</span> =&gt; <span class="string">&quot;aemon&quot;</span>, <span class="string">&quot;a&quot;</span> =&gt; <span class="string">&quot;brange&quot;</span>, <span class="string">&quot;b&quot;</span> =&gt; <span class="string">&quot;canana&quot;</span>, <span class="string">&quot;c&quot;</span> =&gt; <span class="string">&quot;dpple&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">asort</span>(<span class="variable">$fruits</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$fruits</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;d&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;aemon&quot;</span></span><br><span class="line">  [<span class="string">&quot;a&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;brange&quot;</span></span><br><span class="line">  [<span class="string">&quot;b&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;canana&quot;</span></span><br><span class="line">  [<span class="string">&quot;c&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;dpple&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="sort"><a href="#sort" class="headerlink" title="sort"></a><a href="http://php.net/manual/zh/function.sort.php">sort</a></h1><blockquote>
<p>sort — 对数组排序</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$fruits</span> = <span class="keyword">array</span>(<span class="string">&quot;lemon&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">sort</span>(<span class="variable">$fruits</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$fruits</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;apple&quot;</span></span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;banana&quot;</span></span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;lemon&quot;</span></span><br><span class="line">  [<span class="number">3</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">6</span>) <span class="string">&quot;orange&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="list"><a href="#list" class="headerlink" title="list"></a><a href="http://php.net/manual/zh/function.list.php">list</a></h1><blockquote>
<p>list — 把数组中的值赋给一组变量</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$fruits</span> = <span class="keyword">array</span>(<span class="string">&quot;lemon&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$a</span>, <span class="variable">$b</span>, <span class="variable">$c</span>) = <span class="variable">$fruits</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>,<span class="variable">$b</span>,<span class="variable">$c</span>, <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$a</span>,,<span class="variable">$c</span>) = <span class="variable">$fruits</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>,<span class="variable">$c</span>, <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">lemonorangebanana</span><br><span class="line">lemonbanana</span><br></pre></td></tr></table></figure>


</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-06-19</span><i class="fa fa-tag"></i><a class="tag" href="/tags/php/" title="php">php </a><i class="fa fa-tag"></i><a class="tag" href="/tags/array/" title="array">array </a><span>About 1090 words, 3 min 38 sec  read</span></div></div></div></div><div class="post animated"><div class="post-title"><h3><a href="/2018/06/14/2018-06-14-PHP7-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/">PHP7-垃圾回收机制</a></h3></div><div class="post-content"><div class="card"><p><blockquote>
<p>垃圾回收是一种自动的内存管理机制，当一个变量在程序中不再被使用时，应该予以释放，这种内存资源管理称为垃圾回收。其中一种垃圾回收方式是使用引用计数，通过对数据存储的物理空间多附加一个计数器空间，当其他数据与其相关是，计数器加一，反之，相关解除时计数器减一。定期检查各存储对象的计数器，计数器为零的话，则认为该对象已经被抛弃而应将其所占物理空间回收。</p>
</blockquote>
<p>下面是GC的核心数据结构:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_refcounted</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> refcount;</span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ZEND_ENDIAN_LOHI_3(</span><br><span class="line">                zend_uchar    type,</span><br><span class="line">                zend_uchar    flags,</span><br><span class="line">                <span class="type">uint16_t</span>      gc_info)</span><br><span class="line">        &#125; v;</span><br><span class="line">        <span class="type">uint32_t</span> type_info;</span><br><span class="line">    &#125; u;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="http://img.yuekang.org.cn/2018061401.png" alt="zend_refcounted_h的结构"></p>
<p>zend_refcounted由32位bit的refcount和32bit的type_info组成</p>
<p>1. type 第一个字节记录当前元素的类型</p>
<ol start="2">
<li><p>flags 第二个字节用来记录数据类型</p>
</li>
<li><p>gc_info 后面的两个字节标记当前元素的颜色和垃圾回收池中的位置，其中高地址的两位用来标记颜色。</p>
</li>
</ol>
<p>3.1 颜色有 黑色，白色，灰色，紫色</p>
<p>php性能提升<br><img src="http://img.yuekang.org.cn/2018061404.gif"></p>
<h2 id="gc垃圾收集器"><a href="#gc垃圾收集器" class="headerlink" title="gc垃圾收集器"></a>gc垃圾收集器</h2><p>下面是gc_globals的结构</p>
<p><img src="http://img.yuekang.org.cn/2018061802.png"></p>
<p>gc_root_buffer 是一个双向链表，同时记录引用计数的相关信息，zend_gc_globals维护者gc的整个信息，这里列出个字段的含义。</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">字段</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">gc_enabled</td>
<td align="left">是否开启gc</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">gc_active</td>
<td align="left">垃圾回收算法是否运行</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">gc_full</td>
<td align="left">垃圾缓冲区是否满了，在debug模式下有用</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">buf</td>
<td align="left">垃圾缓冲区，PHP7默认大小为10 000个节点位置，0位置保留</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">roots</td>
<td align="left">指向缓冲区中最新加入的可能是垃圾的元素</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">unused</td>
<td align="left">指向缓冲区中没有使用的位置，在没有启动垃圾回收算法前，指向空</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">first_unused</td>
<td align="left">指向缓冲区中第一个未使用的位置，新的元素插入缓冲区后，指针会后移动一位</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">last_unused</td>
<td align="left">指向缓冲区中最后一个位置</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">to_free</td>
<td align="left">待释放的列表</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">next_to_free</td>
<td align="left">下一个待释放的列表</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">gc_runs</td>
<td align="left">记录gc算法的运行的次数，当缓冲区满了，才会运行gc算法</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left">collected</td>
<td align="left">记录gc算法回收的垃圾数</td>
</tr>
</tbody></table>
<h2 id="垃圾收集过程"><a href="#垃圾收集过程" class="headerlink" title="垃圾收集过程"></a>垃圾收集过程</h2><ol>
<li>要求数据类型是数组和对象</li>
<li>没有在缓冲区中存在过</li>
<li>没有被标记过</li>
<li>将其gc_info标记为紫色的，且记录其在缓冲区的位置</li>
</ol>
<p>当缓冲区满时，再收集新的元素会出发垃圾回收算法。</p>
<p>垃圾流转图：</p>
<p><img src="http://img.yuekang.org.cn/2018061801.png"></p>
<p>回收过程分为4部分</p>
<ol>
<li><p>对roots环中每一个元素进行深度优先遍历，将每个元素中gc_info为紫色的标记元素为灰色，且引用计数-1</p>
</li>
<li><p>扫描roots换中gc_info为灰色的元素，如果发现引用计数仍旧大于0，说明这个元素在其他地方使用，那么将其颜色重新标记为黑色，如果发现其引用计数是0则将其标记为白色，该过程同样为深度优先遍历。</p>
</li>
<li><p>扫描roots换，将gc_info颜色为黑色的的元素从roots移除，然后对roots中颜色为白色的元素进行深度有限遍历，将其引用计数+1，然后将roots链表移动到待释放列表中（to_free）中等待回收</p>
</li>
</ol>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-06-14</span><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP/" title="PHP">PHP </a><i class="fa fa-tag"></i><a class="tag" href="/tags/PHP7/" title="PHP7">PHP7 </a><i class="fa fa-tag"></i><a class="tag" href="/tags/垃圾回收/" title="垃圾回收">垃圾回收 </a><span>About 908 words, 3 min 1 sec  read</span></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/page/2/">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/page/4/">Next</a></li></ul></div></div></div></div></main-outlet><script>(async function(){ if (Anatolo.search == null) await Anatolo.getMsg("search-init"); Anatolo.search.config = {translation:{posts:"Posts",pages:"Pages",categories:"Categories",tags:"Tags",untitled:"(Untitled)",} }; })()</script><div class="searchbox ins-search modal-cover"><div class="searchbox-container ins-search-container modal-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="Anatolo.search.closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div><button class="float-button hide" id="scroll-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" type="button" title="Scroll to top"><i class="fa fa-angle-up"></i></button><div class="modal-cover" id="success-indicator"><div class="modal-container indicator"><i class="fa fa-check"></i></div></div></body></html>