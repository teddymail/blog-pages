{"title":"mysql锁有哪些？","date":"2024-09-11T03:09:47.000Z","source":"_posts/2024-09-11-mysql锁有哪些？.md","raw":"---\ntitle: mysql锁有哪些？\ndate: 2024-09-11 11:09:47\ntags: [mysql, 面试题]\n---\n\n> 学习mysql不得不学习mysql行级锁，目前Innodb是支持行级锁的引擎，下面一起学习一下。\n\n# Mysql 行级锁有哪些？\n## 1. Record Lock，记录锁，也就是仅仅把一条记录锁上；\n    \nRecord Lock 称为记录锁，锁住的是一条记录。而且记录锁是有 S 锁和 X 锁之分的：\n\n例如以下语句：\n```sql\nmysql > begin;\nmysql > select * from t_test where id = 1 for update;\n```\n\n事务会对表中主键 id = 1 的这条记录加上 X 型的记录锁，如果这时候其他事务对这条记录进行删除或者更新操作，那么这些操作都会被阻塞。注意，其他事务插入一条 id = 1 的新记录并不会被阻塞，而是会报主键冲突的错误，这是因为主键有唯一性的约束。\n\n## 2. Gap Lock，间隙锁，锁定一个范围，但是不包含记录本身；\n## 3. Next-Key Lock：Record Lock + Gap Lock 的组合，锁定一个范围，并且锁定记录本身。\n\n","slug":"mysql锁有哪些？","published":true,"updated":"2024-09-11T03:23:10.217Z","_id":"cm0xjxci30000nmsnaucyduax","comments":true,"layout":"post","photos":[],"html":"<blockquote>\n<p>学习mysql不得不学习mysql行级锁，目前Innodb是支持行级锁的引擎，下面一起学习一下。</p>\n</blockquote>\n<h1 id=\"Mysql-行级锁有哪些？\"><a href=\"#Mysql-行级锁有哪些？\" class=\"headerlink\" title=\"Mysql 行级锁有哪些？\"></a>Mysql 行级锁有哪些？</h1><h2 id=\"1-Record-Lock，记录锁，也就是仅仅把一条记录锁上；\"><a href=\"#1-Record-Lock，记录锁，也就是仅仅把一条记录锁上；\" class=\"headerlink\" title=\"1. Record Lock，记录锁，也就是仅仅把一条记录锁上；\"></a>1. Record Lock，记录锁，也就是仅仅把一条记录锁上；</h2><p>Record Lock 称为记录锁，锁住的是一条记录。而且记录锁是有 S 锁和 X 锁之分的：</p>\n<p>例如以下语句：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">&gt;</span> <span class=\"keyword\">begin</span>;</span><br><span class=\"line\">mysql <span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t_test <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br></pre></td></tr></table></figure>\n\n<p>事务会对表中主键 id &#x3D; 1 的这条记录加上 X 型的记录锁，如果这时候其他事务对这条记录进行删除或者更新操作，那么这些操作都会被阻塞。注意，其他事务插入一条 id &#x3D; 1 的新记录并不会被阻塞，而是会报主键冲突的错误，这是因为主键有唯一性的约束。</p>\n<h2 id=\"2-Gap-Lock，间隙锁，锁定一个范围，但是不包含记录本身；\"><a href=\"#2-Gap-Lock，间隙锁，锁定一个范围，但是不包含记录本身；\" class=\"headerlink\" title=\"2. Gap Lock，间隙锁，锁定一个范围，但是不包含记录本身；\"></a>2. Gap Lock，间隙锁，锁定一个范围，但是不包含记录本身；</h2><h2 id=\"3-Next-Key-Lock：Record-Lock-Gap-Lock-的组合，锁定一个范围，并且锁定记录本身。\"><a href=\"#3-Next-Key-Lock：Record-Lock-Gap-Lock-的组合，锁定一个范围，并且锁定记录本身。\" class=\"headerlink\" title=\"3. Next-Key Lock：Record Lock + Gap Lock 的组合，锁定一个范围，并且锁定记录本身。\"></a>3. Next-Key Lock：Record Lock + Gap Lock 的组合，锁定一个范围，并且锁定记录本身。</h2>","excerpt":"","more":"<blockquote>\n<p>学习mysql不得不学习mysql行级锁，目前Innodb是支持行级锁的引擎，下面一起学习一下。</p>\n</blockquote>\n<h1 id=\"Mysql-行级锁有哪些？\"><a href=\"#Mysql-行级锁有哪些？\" class=\"headerlink\" title=\"Mysql 行级锁有哪些？\"></a>Mysql 行级锁有哪些？</h1><h2 id=\"1-Record-Lock，记录锁，也就是仅仅把一条记录锁上；\"><a href=\"#1-Record-Lock，记录锁，也就是仅仅把一条记录锁上；\" class=\"headerlink\" title=\"1. Record Lock，记录锁，也就是仅仅把一条记录锁上；\"></a>1. Record Lock，记录锁，也就是仅仅把一条记录锁上；</h2><p>Record Lock 称为记录锁，锁住的是一条记录。而且记录锁是有 S 锁和 X 锁之分的：</p>\n<p>例如以下语句：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql <span class=\"operator\">&gt;</span> <span class=\"keyword\">begin</span>;</span><br><span class=\"line\">mysql <span class=\"operator\">&gt;</span> <span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> t_test <span class=\"keyword\">where</span> id <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">for</span> <span class=\"keyword\">update</span>;</span><br></pre></td></tr></table></figure>\n\n<p>事务会对表中主键 id &#x3D; 1 的这条记录加上 X 型的记录锁，如果这时候其他事务对这条记录进行删除或者更新操作，那么这些操作都会被阻塞。注意，其他事务插入一条 id &#x3D; 1 的新记录并不会被阻塞，而是会报主键冲突的错误，这是因为主键有唯一性的约束。</p>\n<h2 id=\"2-Gap-Lock，间隙锁，锁定一个范围，但是不包含记录本身；\"><a href=\"#2-Gap-Lock，间隙锁，锁定一个范围，但是不包含记录本身；\" class=\"headerlink\" title=\"2. Gap Lock，间隙锁，锁定一个范围，但是不包含记录本身；\"></a>2. Gap Lock，间隙锁，锁定一个范围，但是不包含记录本身；</h2><h2 id=\"3-Next-Key-Lock：Record-Lock-Gap-Lock-的组合，锁定一个范围，并且锁定记录本身。\"><a href=\"#3-Next-Key-Lock：Record-Lock-Gap-Lock-的组合，锁定一个范围，并且锁定记录本身。\" class=\"headerlink\" title=\"3. Next-Key Lock：Record Lock + Gap Lock 的组合，锁定一个范围，并且锁定记录本身。\"></a>3. Next-Key Lock：Record Lock + Gap Lock 的组合，锁定一个范围，并且锁定记录本身。</h2>","path":"2024/09/11/mysql锁有哪些？/","permalink":"https://yuekang.org.cn/2024/09/11/mysql%E9%94%81%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F/","tags":[{"name":"面试题","_id":"cm0w4eg0y000letsn2izgdkl0","slug":"面试题","path":"tags/面试题/","permalink":"https://yuekang.org.cn/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/","length":4},{"name":"mysql","_id":"cm0w4eg1q002tetsnb1509034","slug":"mysql","path":"tags/mysql/","permalink":"https://yuekang.org.cn/tags/mysql/","length":5}],"categories":[],"prev":null,"next":{"title":"mysql事务隔离级别","date":"2024-09-10T02:57:49.000Z","slug":"mysql事务隔离级别","published":true,"updated":"2024-09-10T07:39:22.172Z","_id":"cm0w4eg1u0036etsnh12ado42","layout":"post","photos":[],"excerpt":"","path":"2024/09/10/mysql事务隔离级别/","permalink":"https://yuekang.org.cn/2024/09/10/mysql%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/","__post":true},"__post":true}